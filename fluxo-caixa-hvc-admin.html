<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fluxo de Caixa HVC - Agenda e Pagamentos (Multi-Conta)</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <style>
        /* Tema especÃ­fico HVC - Elegante e sofisticado */
        body {
            display: flex;
            margin: 0;
            min-height: 100vh;
            background: linear-gradient(135deg, #000080, #800080);
            color: #e0e0e0;
        }

        /* Layout responsivo para sidebar */
        #main-content-fluxo-caixa-hvc {
            flex-grow: 1;
            padding: 2rem;
            transition: margin-left 0.3s ease;
            background: linear-gradient(135deg, #000080, #800080);
            margin-left: 250px;
            width: calc(100vw - 250px);
            box-sizing: border-box;
        }

        #main-content-fluxo-caixa-hvc.sidebar-collapsed {
            margin-left: 60px;
            width: calc(100vw - 60px);
        }

        @media (max-width: 768px) {
            #main-content-fluxo-caixa-hvc {
                margin-left: 0;
                width: 100vw;
            }
            
            #main-content-fluxo-caixa-hvc.sidebar-collapsed {
                margin-left: 0;
                width: 100vw;
            }
        }

        .hvc-container {
            background: rgba(25, 25, 112, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 128, 0.3);
            backdrop-filter: blur(10px);
            max-width: 100%;
            box-sizing: border-box;
        }

        .hvc-title {
            color: #ffffff;
            font-size: 2rem;
            margin-bottom: 1.5rem;
            text-align: center;
            word-wrap: break-word;
        }

        /* âœ… NOVO: Estilos para gerenciamento de mÃºltiplas contas */
        .accounts-section {
            background: rgba(25, 25, 112, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            max-width: 100%;
            box-sizing: border-box;
        }

        .accounts-section h2 {
            color: #ffffff;
            font-size: 1.8rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .accounts-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .account-item {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .account-item:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .account-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            min-width: 200px;
        }

        .account-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .account-details {
            flex: 1;
        }

        .account-email {
            color: #ffffff;
            font-weight: 500;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .account-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .account-status.connected {
            color: #34a853;
        }

        .account-status.disconnected {
            color: #ea4335;
        }

        .account-status.syncing {
            color: #ffc107;
        }

        .account-status.error {
            color: #ea4335;
        }

        .account-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .account-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .account-btn.sync {
            background: rgba(66, 133, 244, 0.3);
            border: 1px solid #4285f4;
            color: #4285f4;
        }

        .account-btn.sync:hover {
            background: rgba(66, 133, 244, 0.5);
            color: #ffffff;
        }

        .account-btn.disconnect {
            background: rgba(234, 67, 53, 0.3);
            border: 1px solid #ea4335;
            color: #ea4335;
        }

        .account-btn.disconnect:hover {
            background: rgba(234, 67, 53, 0.5);
            color: #ffffff;
        }

        .account-btn.reconnect {
            background: rgba(255, 193, 7, 0.3);
            border: 1px solid #ffc107;
            color: #ffc107;
        }

        .account-btn.reconnect:hover {
            background: rgba(255, 193, 7, 0.5);
            color: #ffffff;
        }

        .account-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .add-account-section {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 20px;
            margin-top: 20px;
        }

        .no-accounts {
            text-align: center;
            padding: 40px;
            color: rgba(255, 255, 255, 0.6);
        }

        .no-accounts i {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        /* âœ… MODIFICADO: SeÃ§Ã£o de BalanÃ§o Mensal */
        .monthly-summary {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
        }

        .monthly-summary h3 {
            color: #ffc107;
            font-size: 1.5rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .balance-display {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            margin-bottom: 20px;
        }

        .balance-item {
            text-align: center;
        }

        .balance-item.entrada {
            color: #28a745;
        }

        .balance-item.pagamento {
            color: #ea4335;
        }

        .balance-item.saldo {
            color: #ffffff;
            font-size: 1.2em;
            font-weight: bold;
        }

        .balance-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .balance-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .vs-separator {
            color: #ffc107;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .monthly-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            color: #ffc107;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* Lista de Pagamentos */
        .payments-list-section {
            background: rgba(25, 25, 112, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            max-width: 100%;
            box-sizing: border-box;
        }

        .payments-list-section h3 {
            color: #ffffff;
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* âœ… NOVO: Filtros de Pagamentos */
        .payments-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .filter-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 8px 12px;
            color: #ffffff;
            font-size: 0.9rem;
        }

        .filter-input:focus {
            outline: none;
            border-color: #4285f4;
            background: rgba(255, 255, 255, 0.15);
        }

        .filter-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .filter-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 8px 12px;
            color: #ffffff;
            font-size: 0.9rem;
        }

        .filter-select option {
            background: #1a1a2e;
            color: #ffffff;
        }

        .clear-filters-btn {
            background: rgba(234, 67, 53, 0.3);
            border: 1px solid #ea4335;
            border-radius: 6px;
            padding: 8px 16px;
            color: #ea4335;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            align-self: flex-end;
        }

        .clear-filters-btn:hover {
            background: rgba(234, 67, 53, 0.5);
            color: #ffffff;
        }

        .payments-list {
            max-height: 500px;
            overflow-y: auto;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
        }

        .payments-list::-webkit-scrollbar {
            width: 8px;
        }

        .payments-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .payments-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        .payment-item {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .payment-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .payment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .payment-name {
            color: #ffffff;
            font-weight: bold;
            font-size: 1.1rem;
            flex: 1;
            min-width: 200px;
        }

        .payment-value {
            color: #ffc107;
            font-weight: bold;
            font-size: 1.2rem;
            background: rgba(255, 193, 7, 0.2);
            padding: 5px 10px;
            border-radius: 5px;
        }

        .payment-details {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .payment-date {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .payment-status {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .payment-status.pg {
            background: rgba(52, 168, 83, 0.3);
            color: #34a853;
        }

        .payment-status.pendente {
            background: rgba(234, 67, 53, 0.3);
            color: #ea4335;
        }

        .payment-status.recalculado {
            background: rgba(66, 133, 244, 0.3);
            color: #4285f4;
        }

        .payment-account {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(255, 255, 255, 0.1);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .payment-type {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(66, 133, 244, 0.3);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .payment-type.pagamento {
            background: rgba(234, 67, 53, 0.3);
        }

        .payment-type.hvc {
            background: rgba(156, 39, 176, 0.3);
        }

        .payment-type.entrada {
            background: rgba(40, 167, 69, 0.3);
        }

        .no-payments {
            text-align: center;
            padding: 40px;
            color: rgba(255, 255, 255, 0.6);
        }

        .no-payments i {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        /* Calendar View */
        .calendar-section {
            background: rgba(25, 25, 112, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            max-width: 100%;
            box-sizing: border-box;
            overflow-x: auto;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .calendar-nav button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .calendar-nav button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .calendar-title {
            color: #ffffff;
            font-size: 1.5rem;
            font-weight: 500;
            text-align: center;
            min-width: 200px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            overflow: hidden;
            width: 100%;
            min-width: 700px;
        }

        .calendar-day-header {
            background: rgba(66, 133, 244, 0.3);
            color: white;
            padding: 15px 5px;
            text-align: center;
            font-weight: 500;
            font-size: 14px;
            width: 100%;
            box-sizing: border-box;
            min-width: 100px;
        }

        .calendar-day {
            background: rgba(255, 255, 255, 0.05);
            min-height: 140px;
            max-height: 140px;
            padding: 8px;
            position: relative;
            transition: all 0.3s ease;
            width: 100%;
            box-sizing: border-box;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-width: 100px;
        }

        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day.today {
            background: rgba(66, 133, 244, 0.2) !important;
            border: 2px solid #4285f4 !important;
        }

        .day-number {
            color: white;
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 12px;
            flex-shrink: 0;
        }

        .day-total {
            background: rgba(255, 193, 7, 0.8);
            color: #000;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 9px;
            font-weight: bold;
            margin-bottom: 3px;
            text-align: center;
            flex-shrink: 0;
            word-wrap: break-word;
            line-height: 1.1;
        }

        /* âœ… NOVO: Container para totais separados */
        .day-totals-container {
            display: flex;
            flex-direction: column;
            gap: 2px;
            margin-bottom: 3px;
        }

        .entrada-total {
            background: rgba(128, 0, 128, 0.8) !important; /* ROXO para entradas */
            color: #fff !important;
        }

        .pagamento-total {
            background: rgba(139, 69, 19, 0.8) !important; /* MARROM para pagamentos */
            color: #fff !important;
        }

        /* âœ… NOVO: Estilo para saldo do dia */
        .saldo-total {
            font-weight: bold !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
        }

        /* âœ… NOVO: Estilos para eventos agrupados */
        .event-item.pagamento-group {
            background: rgba(108, 117, 125, 0.8);
            color: #000;
            border-left: 4px solid #6c757d;
            font-weight: bold;
        }

        .event-item.entrada-group {
            background: rgba(108, 117, 125, 0.8);
            color: #000;
            border-left: 4px solid #6c757d;
            font-weight: bold;
        }

        .event-item.pagamento-group:hover,
        .event-item.entrada-group:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .day-events {
            display: flex;
            flex-direction: column;
            gap: 2px;
            overflow: hidden;
            flex: 1;
            min-height: 0;
        }

        .event-item {
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            width: 100%;
            box-sizing: border-box;
            min-width: 0;
            flex-shrink: 0;
            border-left: 3px solid transparent;
            background: rgba(108, 117, 125, 0.8);
        }

        .event-item:hover {
            transform: scale(1.02);
            z-index: 10;
            position: relative;
            white-space: normal;
            word-wrap: break-word;
        }

        /* Filter Section */
        .filter-section {
            background: rgba(52, 168, 83, 0.2);
            border: 1px solid rgba(52, 168, 83, 0.4);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            max-width: 100%;
            box-sizing: border-box;
        }

        .filter-info {
            color: #34a853;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            flex-wrap: wrap;
        }

        .filter-stats {
            margin-top: 10px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            word-wrap: break-word;
        }

        /* Event Details Modal */
        .event-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
        }

        .event-modal-content {
            background: linear-gradient(135deg, #000080, #800080);
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            animation: modalSlideIn 0.3s ease;
            box-sizing: border-box;
        }

        .event-total-section {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .event-total-title {
            color: #ffc107;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .event-total-value {
            color: #ffffff;
            font-size: 24px;
            font-weight: bold;
            word-wrap: break-word;
        }

        .event-values-list {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .event-values-list h4 {
            color: #ffc107;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .value-item {
            background: rgba(255, 193, 7, 0.3);
            color: #fff;
            padding: 8px 12px;
            border-radius: 5px;
            margin: 8px 0;
            font-family: monospace;
            font-size: 13px;
            word-wrap: break-word;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .value-item-status {
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
        }

        .value-item-status.pg {
            background: rgba(52, 168, 83, 0.8);
            color: white;
        }

        .value-item-status.pendente {
            background: rgba(234, 67, 53, 0.8);
            color: white;
        }

        .value-item-status.recalculado {
            background: rgba(66, 133, 244, 0.8);
            color: white;
        }

        /* Description editing styles */
        .description-display {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .description-edit-container {
            margin: 15px 0;
        }

        .description-edit-textarea {
            width: 100%;
            min-height: 120px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            color: #ffffff;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            box-sizing: border-box;
        }

        .description-edit-textarea:focus {
            outline: none;
            border-color: #4285f4;
            background: rgba(255, 255, 255, 0.15);
        }

        .description-edit-textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .description-edit-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #000080, #800080);
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            animation: modalSlideIn 0.3s ease;
            box-sizing: border-box;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 15px;
            right: 20px;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: white;
            text-decoration: none;
        }

        .modal h2 {
            color: #ffffff;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal p {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .btn {
            background: rgba(66, 133, 244, 0.3);
            border: 1px solid #4285f4;
            color: #4285f4;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            margin: 5px;
        }

        .btn:hover {
            background: rgba(66, 133, 244, 0.5);
            color: #ffffff;
        }

        .btn-primary {
            background: rgba(66, 133, 244, 0.3);
            border-color: #4285f4;
            color: #4285f4;
        }

        .btn-secondary {
            background: rgba(156, 39, 176, 0.3);
            border-color: #9c27b0;
            color: #9c27b0;
        }

        .btn-secondary:hover {
            background: rgba(156, 39, 176, 0.5);
            color: #ffffff;
        }

        .btn-success {
            background: rgba(52, 168, 83, 0.3);
            border-color: #34a853;
            color: #34a853;
        }

        .btn-success:hover {
            background: rgba(52, 168, 83, 0.5);
            color: #ffffff;
        }

        .btn-warning {
            background: rgba(255, 193, 7, 0.3);
            border-color: #ffc107;
            color: #ffc107;
        }

        .btn-warning:hover {
            background: rgba(255, 193, 7, 0.5);
            color: #ffffff;
        }

        .btn-danger {
            background: rgba(234, 67, 53, 0.3);
            border-color: #ea4335;
            color: #ea4335;
        }

        .btn-danger:hover {
            background: rgba(234, 67, 53, 0.5);
            color: #ffffff;
        }

        .btn-edit {
            background: rgba(255, 193, 7, 0.3);
            border: 1px solid #ffc107;
            color: #ffc107;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin: 10px 0;
        }

        .btn-edit:hover {
            background: rgba(255, 193, 7, 0.5);
            color: #ffffff;
        }

        .btn-save {
            background: rgba(52, 168, 83, 0.3);
            border-color: #34a853;
            color: #34a853;
        }

        .btn-save:hover {
            background: rgba(52, 168, 83, 0.5);
            color: #ffffff;
        }

        .btn-cancel {
            background: rgba(234, 67, 53, 0.3);
            border-color: #ea4335;
            color: #ea4335;
        }

        .btn-cancel:hover {
            background: rgba(234, 67, 53, 0.5);
            color: #ffffff;
        }

        /* Messages */
        .message {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: messageSlideIn 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .message::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: currentColor;
        }

        .message.success {
            background: rgba(52, 168, 83, 0.2);
            border: 1px solid rgba(52, 168, 83, 0.4);
            color: #34a853;
        }

        .message.error {
            background: rgba(234, 67, 53, 0.2);
            border: 1px solid rgba(234, 67, 53, 0.4);
            color: #ea4335;
        }

        .message.warning {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.4);
            color: #ffc107;
        }

        .message.info {
            background: rgba(66, 133, 244, 0.2);
            border: 1px solid rgba(66, 133, 244, 0.4);
            color: #4285f4;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateX(-100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .accounts-section,
            .calendar-section,
            .monthly-summary,
            .payments-list-section {
                padding: 20px;
            }

            .accounts-section h2 {
                font-size: 1.5rem;
            }

            .balance-value {
                font-size: 1.5rem;
            }

            .account-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .account-controls {
                width: 100%;
                justify-content: flex-end;
            }
        }

        @media (max-width: 768px) {
            .monthly-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .balance-display {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .vs-separator {
                display: none;
            }

            .payments-filters {
                grid-template-columns: 1fr;
            }

            .calendar-header {
                flex-direction: column;
                gap: 15px;
            }

            .calendar-nav {
                justify-content: center;
            }

            .calendar-title {
                order: -1;
            }

            .event-modal-content,
            .modal-content {
                width: 95%;
                margin: 2% auto;
                padding: 20px;
            }

            .payment-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .payment-details {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }

        /* âœ… NOVO: CSS para seÃ§Ã£o de criaÃ§Ã£o de eventos (copiado da pÃ¡gina do usuÃ¡rio) */
        .event-creator-section {
            background: rgba(25, 25, 112, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .event-creator-section h3, .event-creator-section h4 {
            color: #ffffff;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .payment-items-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .add-item-form {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            padding: 10px;
            color: #ffffff;
            font-size: 14px;
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .add-item-btn {
            background: linear-gradient(135deg, #4285f4, #34a853);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .add-item-btn:hover {
            background: linear-gradient(135deg, #3367d6, #2d8f47);
            transform: translateY(-2px);
        }

        .items-list {
            margin-top: 20px;
        }

        .payment-item {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item-info {
            flex: 1;
            color: rgba(255, 255, 255, 0.9);
        }

        .item-value {
            font-weight: bold;
            color: #4285f4;
            margin-right: 15px;
        }

        .remove-item-btn {
            background: #ea4335;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s ease;
        }

        .remove-item-btn:hover {
            background: #d33b2c;
        }

        .create-event-form {
            background: rgba(52, 168, 83, 0.1);
            border: 1px solid rgba(52, 168, 83, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .create-event-btn {
            background: linear-gradient(135deg, #34a853, #4285f4);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .create-event-btn:hover {
            background: linear-gradient(135deg, #2d8f47, #3367d6);
            transform: translateY(-2px);
        }

        .cancel-event-btn {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .cancel-event-btn:hover {
            background: rgba(255, 255, 255, 0.2);
              border-color: rgba(255, 255, 255, 0.5);
        }

        /* âœ… NOVO: Estilos para anexos PDF */
        .event-attachments-section {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .event-attachments-section h4 {
            color: #ffd700;
            margin: 0 0 15px 0;
            font-size: 16px;
        }

        .event-attachments-list {
            margin-bottom: 15px;
        }

        .attachment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            margin-bottom: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .attachment-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .attachment-info i {
            color: #ea4335;
            font-size: 18px;
        }

        .attachment-name {
            color: #ffffff;
            font-weight: 500;
        }

        .attachment-actions {
            display: flex;
            gap: 8px;
        }

        .btn-view-attachment,
        .btn-remove-attachment {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn-view-attachment {
            background: #4285f4;
            color: white;
        }

        .btn-view-attachment:hover {
            background: #3367d6;
        }

        .btn-remove-attachment {
            background: #ea4335;
            color: white;
        }

        .btn-remove-attachment:hover {
            background: #d33b2c;
        }

        .attachment-upload-section {
            text-align: center;
        }

        .btn-add-pdf {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn-add-pdf:hover {
            background: #218838;
        }

        .no-attachments {
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
            padding: 20px;
        }

    </style>

    <!-- Google APIs -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>

    <script>
        // =================================================================
        // CONFIGURAÃ‡Ã•ES GLOBAIS
        // =================================================================
        const CLIENT_ID = '314578730498-ghkttnk7g4729g206tk3gsac1qtghhme.apps.googleusercontent.com';
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';
        const DRIVE_DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
        const SCOPES = 'https://www.googleapis.com/auth/calendar.readonly https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/drive.file';

        // âœ… MODIFICADO: Filtro RESTRITIVO - incluindo 'entrada'
        const PAYMENT_KEYWORDS = ['pagamento', 'pagamentos', 'hvc', 'entrada'];

        // VariÃ¡veis globais
        let currentDate = new Date();
        let allPaymentsList = [];
        let filteredPaymentsList = [];
        let filteredPagamentosList = [];
        let filteredEntradaList = [];
        let editingEventId = null;
        let gapi_loaded = false;
        let gsi_loaded = false;
        let tokenClient;

        // âœ… NOVO: VariÃ¡veis para criaÃ§Ã£o de eventos (copiadas da pÃ¡gina do usuÃ¡rio)
        let paymentItems = [];
        let accountManager;

        // âœ… CORRIGIDO: Gerenciador de mÃºltiplas contas com filtro APENAS NO TÃTULO
        class AccountManager {
            constructor() {
                this.accounts = new Map();
                this.loadFromStorage();
            }

            saveToStorage() {
                const accountsData = Array.from(this.accounts.entries()).map(([id, account]) => [
                    id,
                    {
                        ...account,
                        lastSync: account.lastSync ? account.lastSync.toISOString() : null
                    }
                ]);
                localStorage.setItem('hvc_accounts', JSON.stringify(accountsData));
            }

            loadFromStorage() {
                try {
                    const stored = localStorage.getItem('hvc_accounts');
                    if (stored) {
                        const accountsData = JSON.parse(stored);
                        // Verificar se Ã© um array antes de usar forEach
                        if (Array.isArray(accountsData)) {
                            accountsData.forEach(([id, account]) => {
                                this.accounts.set(id, {
                                    ...account,
                                    lastSync: account.lastSync ? new Date(account.lastSync) : null
                                });
                            });
                        } else {
                            // Se nÃ£o for array, limpar storage corrompido
                            console.warn('âš ï¸ Storage corrompido, limpando...');
                            localStorage.removeItem('hvc_accounts');
                        }
                    }
                } catch (error) {
                    console.error('âŒ Erro ao carregar contas do storage:', error);
                    // Limpar storage em caso de erro
                    localStorage.removeItem('hvc_accounts');
                }
            }

            addAccount(accountInfo) {
                const account = {
                    id: accountInfo.email,
                    email: accountInfo.email,
                    displayName: accountInfo.name || accountInfo.email,
                    isConnected: true,
                    syncStatus: 'connected',
                    events: [],
                    lastSync: null,
                    color: this.generateAccountColor(accountInfo.email)
                };
                
                this.accounts.set(account.id, account);
                this.saveToStorage();
                return account;
            }

            updateAccountEvents(accountId, events) {
                const account = this.accounts.get(accountId);
                if (account) {
                    // âœ… CORRIGIDO: Aplicar filtro APENAS NO TÃTULO ao salvar eventos
                    const filteredEvents = this.applyTitleOnlyFilter(events);
                    account.events = filteredEvents;
                    account.lastSync = new Date();
                    this.saveToStorage();
                    return filteredEvents;
                }
            }

            // âœ… NOVO: FunÃ§Ã£o que aplica filtro APENAS NO TÃTULO (nÃ£o na descriÃ§Ã£o)
            applyTitleOnlyFilter(events) {
                return events.filter(event => {
                    const title = (event.summary || '').toLowerCase();
                    
                    // âœ… FILTRO APENAS NO TÃTULO: Deve conter uma das palavras-chave no tÃ­tulo
                    const hasKeywordInTitle = PAYMENT_KEYWORDS.some(keyword => 
                        title.includes(keyword.toLowerCase())
                    );
                    
                    return hasKeywordInTitle;
                });
            }

            generateAccountColor(email) {
                const colors = ['#4285f4', '#ea4335', '#34a853', '#fbbc04', '#9c27b0', '#ff5722', '#607d8b', '#795548'];
                const hash = email.split('').reduce((a, b) => {
                    a = ((a << 5) - a) + b.charCodeAt(0);
                    return a & a;
                }, 0);
                return colors[Math.abs(hash) % colors.length];
            }

            getAllAccounts() {
                return Array.from(this.accounts.values());
            }

            getConnectedAccounts() {
                return Array.from(this.accounts.values()).filter(account => account.isConnected);
            }

            getAllEvents() {
                const allEvents = [];
                this.accounts.forEach(account => {
                    if (account.events && account.isConnected) {
                        account.events.forEach(event => {
                            allEvents.push({
                                ...event,
                                accountEmail: account.email,
                                accountColor: account.color
                            });
                        });
                    }
                });
                return allEvents;
            }

            updateAccountStatus(accountId, status) {
                const account = this.accounts.get(accountId);
                if (account) {
                    account.syncStatus = status;
                    this.saveToStorage();
                }
            }

            disconnectAccount(accountId) {
                const account = this.accounts.get(accountId);
                if (account) {
                    account.isConnected = false;
                    account.syncStatus = 'disconnected';
                    account.events = [];
                    this.saveToStorage();
                }
            }

            removeAccount(accountId) {
                this.accounts.delete(accountId);
                this.saveToStorage();
            }
        }

        // InstÃ¢ncia global do gerenciador de contas
        accountManager = new AccountManager();

        // =================================================================
        // INICIALIZAÃ‡ÃƒO DA API GOOGLE
        // =================================================================
        function gapiLoaded() {
            gapi_loaded = true;
            maybeEnableButtons();
        }

        function gsiLoaded() {
            console.log('ðŸ”„ Carregando GIS...');
            try {
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID,
                    scope: SCOPES,
                    callback: (response) => {
                        if (response.error) {
                            console.error('âŒ Erro na autenticaÃ§Ã£o:', response.error);
                            showMessage('Erro na autenticaÃ§Ã£o: ' + response.error, 'error');
                        } else {
                            console.log('âœ… AutenticaÃ§Ã£o realizada com sucesso');
                        }
                    },
                });
                gsi_loaded = true;
                maybeEnableButtons();
                console.log('âœ… GIS inicializado com sucesso!');
            } catch (error) {
                console.error('âŒ Erro ao inicializar GIS:', error);
                showMessage('Erro ao carregar sistema de autenticaÃ§Ã£o do Google', 'error');
            }
        }

        function maybeEnableButtons() {
            if (gapi_loaded && gsi_loaded) {
            }
        }

        // =================================================================
        // AUTENTICAÃ‡ÃƒO E GERENCIAMENTO DE CONTAS
        // =================================================================
        async function handleAddAccount() {
            try {
                await gapi.load('client', async () => {
                    await gapi.client.init({
                        apiKey: '',
                        discoveryDocs: [DISCOVERY_DOC, DRIVE_DISCOVERY_DOC],
                    });

                    const tokenClient = google.accounts.oauth2.initTokenClient({
                        client_id: CLIENT_ID,
                        scope: SCOPES,
                        callback: async (response) => {
                            if (response.error) {
                                console.error('âŒ Erro na autenticaÃ§Ã£o:', response.error);
                                showMessage('Erro na autenticaÃ§Ã£o: ' + response.error, 'error');
                                return;
                            }

                            try {
                                // Obter informaÃ§Ãµes do usuÃ¡rio
                                const userInfoResponse = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
                                    headers: {
                                        'Authorization': `Bearer ${response.access_token}`
                                    }
                                });

                                if (!userInfoResponse.ok) {
                                    throw new Error('Erro ao obter informaÃ§Ãµes do usuÃ¡rio');
                                }

                                const userInfo = await userInfoResponse.json();
                                
                                // Verificar se a conta jÃ¡ existe
                                if (accountManager.accounts.has(userInfo.email)) {
                                    showMessage('Esta conta jÃ¡ estÃ¡ conectada', 'warning');
                                    return;
                                }

                                // Adicionar nova conta
                                const account = accountManager.addAccount(userInfo);
                                showMessage(`Conta ${userInfo.email} conectada com sucesso!`, 'success');
                                
                                // Sincronizar eventos da nova conta
                                await syncAccountEvents(account.id);
                                
                                // Atualizar interface
                                updateAccountsList();
                                updateAllData();

                            } catch (error) {
                                console.error('âŒ Erro ao processar conta:', error);
                                showMessage('Erro ao conectar conta: ' + error.message, 'error');
                            }
                        },
                    });

                    tokenClient.requestAccessToken();
                });

            } catch (error) {
                console.error('âŒ Erro ao inicializar autenticaÃ§Ã£o:', error);
                showMessage('Erro ao inicializar autenticaÃ§Ã£o', 'error');
            }
        }

        async function syncAccountEvents(accountId) {
            const account = accountManager.accounts.get(accountId);
            if (!account) {
                console.error('âŒ Conta nÃ£o encontrada:', accountId);
                return;
            }

            try {
                accountManager.updateAccountStatus(accountId, 'syncing');
                updateAccountsList();

                // Reautenticar para esta conta especÃ­fica
                await gapi.load('client', async () => {
                    await gapi.client.init({
                        apiKey: '',
                        discoveryDocs: [DISCOVERY_DOC, DRIVE_DISCOVERY_DOC],
                    });

                    const tokenClient = google.accounts.oauth2.initTokenClient({
                        client_id: CLIENT_ID,
                        scope: SCOPES,
                        hint: account.email,
                        callback: async (response) => {
                            if (response.error) {
                                console.error('âŒ Erro na reautenticaÃ§Ã£o:', response.error);
                                accountManager.updateAccountStatus(accountId, 'error');
                                updateAccountsList();
                                showMessage(`Erro ao sincronizar ${account.email}: ${response.error}`, 'error');
                                return;
                            }

                            try {
                                // Carregar eventos
                                const events = await loadEventsForAccount();
                                const filteredEvents = accountManager.updateAccountEvents(accountId, events);
                                
                                accountManager.updateAccountStatus(accountId, 'connected');
                                updateAccountsList();
                                updateAllData();
                                
                                showMessage(`${filteredEvents.length} eventos sincronizados para ${account.email}`, 'success');

                            } catch (error) {
                                console.error('âŒ Erro ao carregar eventos:', error);
                                accountManager.updateAccountStatus(accountId, 'error');
                                updateAccountsList();
                                showMessage(`Erro ao carregar eventos de ${account.email}: ${error.message}`, 'error');
                            }
                        },
                    });

                    tokenClient.requestAccessToken();
                });

            } catch (error) {
                console.error('âŒ Erro na sincronizaÃ§Ã£o:', error);
                accountManager.updateAccountStatus(accountId, 'error');
                updateAccountsList();
                showMessage(`Erro ao sincronizar ${account.email}: ${error.message}`, 'error');
            }
        }

        async function reconnectAccount(accountId) {
            const account = accountManager.accounts.get(accountId);
            if (account) {
                account.isConnected = true;
                await syncAccountEvents(accountId);
            }
        }

        function disconnectAccount(accountId) {
            accountManager.disconnectAccount(accountId);
            updateAccountsList();
            updateAllData();
            showMessage('Conta desconectada', 'info');
        }

        async function syncAllAccounts() {
            const connectedAccounts = accountManager.getConnectedAccounts();
            
            if (connectedAccounts.length === 0) {
                showMessage('Nenhuma conta conectada para sincronizar', 'warning');
                return;
            }

            showMessage('Sincronizando todas as contas...', 'info');

            for (const account of connectedAccounts) {
                await syncAccountEvents(account.id);
                // Pequena pausa entre sincronizaÃ§Ãµes para evitar rate limiting
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            showMessage('SincronizaÃ§Ã£o de todas as contas concluÃ­da!', 'success');
        }

        // âœ… CORRIGIDO: Carregamento de eventos SEM filtro (filtro APENAS NO TÃTULO aplicado depois)
        async function loadEventsForAccount() {
            try {
                const now = new Date();
                const timeMin = new Date(now.getFullYear(), now.getMonth() - 2, 1).toISOString();
                const timeMax = new Date(now.getFullYear(), now.getMonth() + 3, 0).toISOString();


                const response = await gapi.client.calendar.events.list({
                    calendarId: 'primary',
                    timeMin: timeMin,
                    timeMax: timeMax,
                    showDeleted: false,
                    singleEvents: true,
                    maxResults: 1000,
                    orderBy: 'startTime'
                });

                if (response.status !== 200) {
                    throw new Error(`API retornou status ${response.status}: ${response.statusText}`);
                }

                const events = response.result.items || [];
                
                
                return events;
                
            } catch (error) {
                console.error('âŒ Erro ao carregar eventos:', error);
                
                if (error.status === 403) {
                    throw new Error('Acesso negado. Verifique as permissÃµes da conta.');
                } else if (error.status === 401) {
                    throw new Error('Token de acesso expirado ou invÃ¡lido.');
                } else {
                    throw new Error(`Erro na API: ${error.message || 'Erro desconhecido'}`);
                }
            }
        }

        async function updateAllData() {
            try {
                const allEvents = accountManager.getAllEvents();
                
                updateFilterStats(allEvents);
                updateMonthlySummary(allEvents);
                renderCalendar(allEvents);
                updateAccountFilter();
                
                const hasConnectedAccounts = accountManager.getConnectedAccounts().length > 0;
                toggleSections(hasConnectedAccounts);
                
            } catch (error) {
                console.error('âŒ Erro ao atualizar dados:', error);
            }
        }

        function toggleSections(show) {
            const sections = [
                'calendarSection',
                'filterSection', 
                'monthlySummarySection',
                'separatedSummarySection'
            ];
            
            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.style.display = show ? 'block' : 'none';
                }
            });
        }

        // =================================================================
        // INTERFACE DE GERENCIAMENTO DE CONTAS
        // =================================================================
        function updateAccountsList() {
            const accountsListElement = document.getElementById('accountsList');
            if (!accountsListElement) return;

            const accounts = accountManager.getAllAccounts();
            
            if (accounts.length === 0) {
                accountsListElement.innerHTML = `
                    <div class="no-accounts">
                        <i class="fas fa-user-plus"></i>
                        <p>Nenhuma conta conectada</p>
                        <p style="font-size: 0.9rem;">Adicione uma conta do Google Calendar para comeÃ§ar</p>
                    </div>
                `;
                return;
            }

            accountsListElement.innerHTML = accounts.map(account => {
                const statusIcon = getAccountStatusIcon(account.syncStatus);
                const statusClass = account.isConnected ? 'connected' : 'disconnected';
                
                let lastSyncText = '';
                if (account.lastSync && account.lastSync instanceof Date && !isNaN(account.lastSync)) {
                    lastSyncText = `â€¢ Ãšltima sync: ${account.lastSync.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}`;
                }
                
                const eventCount = account.events ? account.events.length : 0;
                const eventCountText = eventCount > 0 ? `â€¢ ${eventCount} eventos` : '';
                
                let actionButtons = '';
                if (account.isConnected && account.syncStatus !== 'error') {
                    actionButtons = `
                        <button onclick="syncAccountEvents('${account.id}')" 
                                class="account-btn sync" 
                                ${account.syncStatus === 'syncing' ? 'disabled' : ''}>
                            <i class="fas fa-sync-alt"></i>
                            ${account.syncStatus === 'syncing' ? 'Sincronizando...' : 'Sincronizar'}
                        </button>
                    `;
                } else {
                    actionButtons = `
                        <button onclick="reconnectAccount('${account.id}')" 
                                class="account-btn reconnect">
                            <i class="fas fa-plug"></i>
                            Reconectar
                        </button>
                    `;
                }
                
                return `
                    <div class="account-item" style="border-left-color: ${account.color}">
                        <div class="account-info">
                            <div class="account-avatar" style="background-color: ${account.color}">
                                ${account.displayName.charAt(0).toUpperCase()}
                            </div>
                            <div class="account-details">
                                <div class="account-email">${account.email}</div>
                                <div class="account-status ${statusClass}">
                                    <i class="fas ${statusIcon}"></i>
                                    ${getAccountStatusText(account.syncStatus)}
                                    ${lastSyncText}
                                    ${eventCountText}
                                </div>
                            </div>
                        </div>
                        <div class="account-controls">
                            ${actionButtons}
                            <button onclick="disconnectAccount('${account.id}')" 
                                    class="account-btn disconnect">
                                <i class="fas fa-unlink"></i>
                                Desconectar
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getAccountStatusIcon(status) {
            switch (status) {
                case 'connected': return 'fa-check-circle';
                case 'syncing': return 'fa-sync-alt fa-spin';
                case 'error': return 'fa-exclamation-triangle';
                case 'disconnected': return 'fa-times-circle';
                default: return 'fa-question-circle';
            }
        }

        function getAccountStatusText(status) {
            switch (status) {
                case 'connected': return 'Conectado';
                case 'syncing': return 'Sincronizando';
                case 'error': return 'Erro - Token expirado';
                case 'disconnected': return 'Desconectado';
                default: return 'Status desconhecido';
            }
        }

        // =================================================================
        // SISTEMA DE EXTRAÃ‡ÃƒO COM STATUS MELHORADO
        // =================================================================
        function extractPaymentInfo(text) {
            if (!text) return [];
            
            const paymentRegex = /([^-\n\r]+?)\s*-\s*R\$\s*([\d.]+,\d{2})\s*(\([^)]*\))?/gi;
            const matches = [];
            let match;
            
            while ((match = paymentRegex.exec(text)) !== null) {
                let paymentName = match[1].trim();
                
                // Remover "PAGAMENTO" do inÃ­cio se existir
                if (paymentName.toLowerCase().startsWith('pagamento ')) {
                    paymentName = paymentName.substring(10).trim(); // Remove "PAGAMENTO "
                }
                
                const valueStr = match[2];
                const statusText = match[3] ? match[3].replace(/[()]/g, '').trim() : '';
                const numericValue = parseFloat(valueStr.replace(/\./g, '').replace(',', '.'));
                
                let status = 'PENDENTE';
                
                if (statusText) {
                    const statusLower = statusText.toLowerCase();
                    if (statusLower.includes('pg')) {
                        status = 'PG';
                    } else if (statusLower.includes('recalculado')) {
                        status = 'RECALCULADO';
                    }
                }
                
                matches.push({
                    name: paymentName,
                    original: `${paymentName} - ${formatCurrency(numericValue)} (${status})`,
                    value: numericValue,
                    formattedValue: formatCurrency(numericValue),
                    status: status,
                    statusText: statusText
                });
            }
            
            if (matches.length === 0) {
                const moneyRegex = /R\$\s*([\d.]+,\d{2})/gi;
                const moneyMatches = text.match(moneyRegex) || [];
                
                moneyMatches.forEach(match => {
                    const valueStr = match.replace(/R\$\s*/, '');
                    const numericValue = parseFloat(valueStr.replace(/\./g, '').replace(',', '.'));
                    
                    matches.push({
                        name: 'Pagamento',
                        original: formatCurrency(numericValue),
                        value: numericValue,
                        formattedValue: formatCurrency(numericValue),
                        status: 'PENDENTE',
                        statusText: ''
                    });
                });
            }
            
            return matches;
        }

        // âœ… NOVO: FunÃ§Ã£o especÃ­fica para extrair informaÃ§Ãµes de ENTRADA
        function extractEntradaInfo(text) {
            if (!text) return [];
            
            const entradaRegex = /([^-\n\r]+?)\s*-\s*R\$\s*([\d.]+,\d{2})\s*(\([^)]*\))?/gi;
            const matches = [];
            let match;
            
            while ((match = entradaRegex.exec(text)) !== null) {
                let entradaName = match[1].trim();
                
                // Remover "ENTRADA" do inÃ­cio se existir
                if (entradaName.toLowerCase().startsWith('entrada ')) {
                    entradaName = entradaName.substring(8).trim(); // Remove "ENTRADA "
                }
                
                const valueStr = match[2];
                const statusText = match[3] ? match[3].replace(/[()]/g, '').trim() : '';
                const numericValue = parseFloat(valueStr.replace(/\./g, '').replace(',', '.'));
                
                let status = 'AGUARDANDO'; // Status padrÃ£o para entradas
                
                if (statusText) {
                    const statusLower = statusText.toLowerCase();
                    if (statusLower.includes('rc')) {
                        status = 'RC';
                    } else if (statusLower.includes('adiado')) {
                        status = 'ADIADO';
                    }
                }
                
                matches.push({
                    name: entradaName,
                    original: `${entradaName} - ${formatCurrency(numericValue)} (${status})`,
                    value: numericValue,
                    formattedValue: formatCurrency(numericValue),
                    status: status,
                    statusText: statusText
                });
            }
            
            if (matches.length === 0) {
                const moneyRegex = /R\$\s*([\d.]+,\d{2})/gi;
                const moneyMatches = text.match(moneyRegex) || [];
                
                moneyMatches.forEach(match => {
                    const valueStr = match.replace(/R\$\s*/, '');
                    const numericValue = parseFloat(valueStr.replace(/\./g, '').replace(',', '.'));
                    
                    matches.push({
                        name: 'Entrada',
                        original: formatCurrency(numericValue),
                        value: numericValue,
                        formattedValue: formatCurrency(numericValue),
                        status: 'AGUARDANDO',
                        statusText: ''
                    });
                });
            }
            
            return matches;
        }

        function calculateEventTotal(event) {
            const summary = (event.summary || '').toLowerCase();
            
            // âœ… MODIFICADO: AnÃ¡lise detalhada para eventos com "PAGAMENTO"/"PAGAMENTOS" ou "ENTRADA"
            const isPagamentoEvent = summary.includes('pagamento') || summary.includes('pagamentos');
            const isEntradaEvent = summary.includes('entrada');
            
            if (!isPagamentoEvent && !isEntradaEvent) {
                // Para eventos que NÃƒO sÃ£o de pagamento nem entrada (HVC, etc.), retornar estrutura vazia
                return {
                    total: 0,
                    payments: [],
                    countablePayments: [],
                    count: 0,
                    countableCount: 0
                };
            }
            
            // AnÃ¡lise detalhada para eventos de PAGAMENTO ou ENTRADA
            const description = event.description || '';
            const fullText = `${event.summary || ''} ${description}`;
            
            let payments;
            let countablePayments;
            
            if (isEntradaEvent) {
                // âœ… NOVO: Usar funÃ§Ã£o especÃ­fica para ENTRADA
                payments = extractEntradaInfo(fullText);
                countablePayments = payments.filter(p => p.status === 'RC' || p.status === 'AGUARDANDO');
            } else {
                // Usar funÃ§Ã£o original para PAGAMENTO
                payments = extractPaymentInfo(fullText);
                countablePayments = payments.filter(p => p.status === 'PG' || p.status === 'PENDENTE');
            }
            
            const total = countablePayments.reduce((sum, item) => sum + item.value, 0);
            
            return {
                total: total,
                payments: payments,
                countablePayments: countablePayments,
                count: payments.length,
                countableCount: countablePayments.length
            };
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        function calculateDayTotal(date, events) {
            const eventsForDay = getEventsForDay(date, events);
            let pagamentoTotal = 0;
            let entradaTotal = 0;
            
            eventsForDay.forEach(event => {
                const eventType = getEventType(event);
                const eventCalc = calculateEventTotal(event);
                
                if (eventType === 'entrada') {
                    entradaTotal += eventCalc.total;
                } else if (eventType === 'pagamento') {
                    pagamentoTotal += eventCalc.total;
                }
            });
            
            return {
                pagamento: pagamentoTotal,
                entrada: entradaTotal,
                total: pagamentoTotal + entradaTotal
            };
        }

        // âœ… NOVO: FunÃ§Ã£o para agrupar eventos por tipo no dia
        function getGroupedEventsForDay(date, events) {
            const eventsForDay = getEventsForDay(date, events);
            const grouped = {
                pagamento: [],
                entrada: [],
                outros: []
            };
            
            eventsForDay.forEach(event => {
                const eventType = getEventType(event);
                if (eventType === 'entrada') {
                    grouped.entrada.push(event);
                } else if (eventType === 'pagamento') {
                    grouped.pagamento.push(event);
                } else {
                    grouped.outros.push(event);
                }
            });
            
            return grouped;
        }

        // =================================================================
        // âœ… MODIFICADO: CÃLCULOS MENSAIS COM BALANÃ‡O ENTRADA vs PAGAMENTO
        // =================================================================
        function calculateMonthlyTotals(events) {
            const currentMonth = currentDate.getMonth();
            const currentYear = currentDate.getFullYear();
            
            // âœ… MODIFICADO: Separar totais por status
            let entradaRC = 0;          // Entradas confirmadas (RC)
            let entradaAguardando = 0;  // Entradas aguardando
            let pagamentoPG = 0;        // Pagamentos confirmados (PG)
            let pagamentoPendente = 0;  // Pagamentos pendentes
            let totalEvents = 0;
            
            events.forEach(event => {
                const eventDate = parseEventDate(event);
                
                if (eventDate.getMonth() === currentMonth && eventDate.getFullYear() === currentYear) {
                    const eventType = getEventType(event);
                    const eventCalc = calculateEventTotal(event);
                    totalEvents++;
                    
                    if (eventType === 'entrada') {
                        // âœ… NOVO: Separar entradas por status
                        eventCalc.payments.forEach(payment => {
                            if (payment.status === 'RC') {
                                entradaRC += payment.value;
                            } else if (payment.status === 'AGUARDANDO') {
                                entradaAguardando += payment.value;
                            }
                        });
                    } else if (eventType === 'pagamento') {
                        // âœ… NOVO: Separar pagamentos por status
                        eventCalc.payments.forEach(payment => {
                            if (payment.status === 'PG') {
                                pagamentoPG += payment.value;
                            } else if (payment.status === 'PENDENTE') {
                                pagamentoPendente += payment.value;
                            }
                        });
                    }
                }
            });
            
            // Calcular totais e saldos
            const entradaTotal = entradaRC + entradaAguardando;
            const pagamentoTotal = pagamentoPG + pagamentoPendente;
            const saldoConfirmado = entradaRC - pagamentoPG;      // RC vs PG
            const saldoPendente = entradaAguardando - pagamentoPendente; // AGUARDANDO vs PENDENTE
            const saldoTotal = entradaTotal - pagamentoTotal;     // Saldo geral
            
            return {
                // Totais gerais (compatibilidade)
                entradaTotal: entradaTotal,
                pagamentoTotal: pagamentoTotal,
                saldo: saldoTotal,
                events: totalEvents,
                
                // âœ… NOVO: Detalhamento por status
                entradaRC: entradaRC,
                entradaAguardando: entradaAguardando,
                pagamentoPG: pagamentoPG,
                pagamentoPendente: pagamentoPendente,
                saldoConfirmado: saldoConfirmado,
                saldoPendente: saldoPendente,
                saldoTotal: saldoTotal
            };
        }

        // âœ… MODIFICADO: FunÃ§Ã£o para calcular totais separados com detalhes de pagamento
        function calculateSeparatedTotals(events) {
            const currentMonth = currentDate.getMonth();
            const currentYear = currentDate.getFullYear();
            
            let pagamentoTotal = 0;
            let pagamentoPago = 0;
            let pagamentoPendente = 0;
            let entradaTotal = 0;
            let pagamentoEvents = 0;
            let entradaEvents = 0;
            let pagamentoItems = 0;
            
            const pagamentosList = [];
            const entradaList = [];
            
            // Calcular dias do mÃªs para mÃ©dia
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            events.forEach(event => {
                const eventDate = parseEventDate(event);
                
                if (eventDate.getMonth() === currentMonth && eventDate.getFullYear() === currentYear) {
                    const eventType = getEventType(event);
                    const eventCalc = calculateEventTotal(event);
                    
                    if (eventType === 'entrada') {
                        entradaTotal += eventCalc.total;
                        entradaEvents++;
                        
                        eventCalc.payments.forEach(payment => {
                            entradaList.push({
                                ...payment,
                                eventTitle: event.summary || 'Sem tÃ­tulo',
                                eventDate: eventDate,
                                eventType: eventType,
                                eventId: event.id,
                                accountEmail: event.accountEmail || 'Conta desconhecida',
                                accountColor: event.accountColor || '#4285f4'
                            });
                        });
                    } else {
                        pagamentoTotal += eventCalc.total;
                        pagamentoEvents++;
                        pagamentoItems += eventCalc.payments.length;
                        
                        eventCalc.payments.forEach(payment => {
                            if (payment.status === 'PG') {
                                pagamentoPago += payment.value;
                            } else if (payment.status === 'PENDENTE') {
                                pagamentoPendente += payment.value;
                            }
                            
                            pagamentosList.push({
                                ...payment,
                                eventTitle: event.summary || 'Sem tÃ­tulo',
                                eventDate: eventDate,
                                eventType: eventType,
                                eventId: event.id,
                                accountEmail: event.accountEmail || 'Conta desconhecida',
                                accountColor: event.accountColor || '#4285f4'
                            });
                        });
                    }
                }
            });
            
            pagamentosList.sort((a, b) => b.eventDate - a.eventDate);
            entradaList.sort((a, b) => b.eventDate - a.eventDate);
            
            const mediaPorDia = pagamentoItems > 0 ? pagamentoTotal / daysInMonth : 0;
            
            return {
                pagamento: {
                    total: pagamentoTotal,
                    pago: pagamentoPago,
                    pendente: pagamentoPendente,
                    events: pagamentoEvents,
                    items: pagamentoItems,
                    mediaPorDia: mediaPorDia,
                    list: pagamentosList
                },
                entrada: {
                    total: entradaTotal,
                    events: entradaEvents,
                    list: entradaList
                }
            };
        }

        function updateMonthlySummary(events) {
            // âœ… MODIFICADO: Atualizar balanÃ§o mensal com saldos detalhados
            const monthlyData = calculateMonthlyTotals(events);
            
            // âœ… NOVO: Atualizar saldos confirmados (RC vs PG)
            const entradaRCEl = document.getElementById('entradaRCBalance');
            const pagamentoPGEl = document.getElementById('pagamentoPGBalance');
            const saldoConfirmadoEl = document.getElementById('saldoConfirmadoBalance');
            
            if (entradaRCEl) entradaRCEl.textContent = formatCurrency(monthlyData.entradaRC);
            if (pagamentoPGEl) pagamentoPGEl.textContent = formatCurrency(monthlyData.pagamentoPG);
            if (saldoConfirmadoEl) {
                saldoConfirmadoEl.textContent = formatCurrency(monthlyData.saldoConfirmado);
                saldoConfirmadoEl.style.color = monthlyData.saldoConfirmado >= 0 ? '#28a745' : '#ea4335';
            }
            
            // âœ… NOVO: Atualizar saldos pendentes (AGUARDANDO vs PENDENTE)
            const entradaAguardandoEl = document.getElementById('entradaAguardandoBalance');
            const pagamentoPendenteEl = document.getElementById('pagamentoPendenteBalance');
            const saldoPendenteEl = document.getElementById('saldoPendenteBalance');
            
            if (entradaAguardandoEl) entradaAguardandoEl.textContent = formatCurrency(monthlyData.entradaAguardando);
            if (pagamentoPendenteEl) pagamentoPendenteEl.textContent = formatCurrency(monthlyData.pagamentoPendente);
            if (saldoPendenteEl) {
                saldoPendenteEl.textContent = formatCurrency(monthlyData.saldoPendente);
                saldoPendenteEl.style.color = monthlyData.saldoPendente >= 0 ? '#28a745' : '#ea4335';
            }
            
            // âœ… MODIFICADO: Atualizar totais gerais
            const entradaTotalEl = document.getElementById('entradaTotalBalance');
            const pagamentoTotalEl = document.getElementById('pagamentoTotalBalance');
            const saldoEl = document.getElementById('saldoBalance');
            const totalEventsEl = document.getElementById('totalEvents');
            
            if (entradaTotalEl) entradaTotalEl.textContent = formatCurrency(monthlyData.entradaTotal);
            if (pagamentoTotalEl) pagamentoTotalEl.textContent = formatCurrency(monthlyData.pagamentoTotal);
            if (saldoEl) {
                saldoEl.textContent = formatCurrency(monthlyData.saldoTotal);
                saldoEl.style.color = monthlyData.saldoTotal >= 0 ? '#28a745' : '#ea4335';
            }
            if (totalEventsEl) totalEventsEl.textContent = monthlyData.events;
            
            // âœ… MODIFICADO: Atualizar resumos separados com novos dados
            const separatedData = calculateSeparatedTotals(events);

            // Atualizar totais de pagamento
            const pagamentoTotalSepEl = document.getElementById('pagamentoTotal');
            const pagamentoPagoEl = document.getElementById('pagamentoPago');
            const pagamentoPendenteEl2 = document.getElementById('pagamentoPendente');
            const pagamentoEventsSepEl = document.getElementById('pagamentoEvents');
            const pagamentoItemsEl = document.getElementById('pagamentoItems');
            const pagamentoMediaEl = document.getElementById('pagamentoMedia');

            if (pagamentoTotalSepEl) pagamentoTotalSepEl.textContent = formatCurrency(separatedData.pagamento.total);
            if (pagamentoPagoEl) pagamentoPagoEl.textContent = formatCurrency(separatedData.pagamento.pago);
            if (pagamentoPendenteEl2) pagamentoPendenteEl2.textContent = formatCurrency(separatedData.pagamento.pendente);
            if (pagamentoEventsSepEl) pagamentoEventsSepEl.textContent = separatedData.pagamento.events;
            if (pagamentoItemsEl) pagamentoItemsEl.textContent = separatedData.pagamento.items;
            if (pagamentoMediaEl) pagamentoMediaEl.textContent = formatCurrency(separatedData.pagamento.mediaPorDia);

            // Atualizar totais de entrada
            const entradaTotalSepEl = document.getElementById('entradaTotal');
            const entradaEventsSepEl = document.getElementById('entradaEvents');

            if (entradaTotalSepEl) entradaTotalSepEl.textContent = formatCurrency(separatedData.entrada.total);
            if (entradaEventsSepEl) entradaEventsSepEl.textContent = separatedData.entrada.events;

            // Atualizar listas
            updatePaymentsList('pagamentosList', separatedData.pagamento.list);
            updatePaymentsList('entradaList', separatedData.entrada.list);

            // Mostrar seÃ§Ãµes
            const monthlySummarySection = document.getElementById('monthlySummarySection');
            if (monthlySummarySection) {
                monthlySummarySection.style.display = 'block';
            }

            const separatedSummarySection = document.getElementById('separatedSummarySection');
            if (separatedSummarySection) {
                separatedSummarySection.style.display = 'block';
            }
        }

        function updateFilterStats(allEvents) {
            const filterStatsElement = document.getElementById('filterStats');
            if (!filterStatsElement) return;
            
            const connectedAccounts = accountManager.getConnectedAccounts();
            const totalEvents = allEvents.length;
            
            filterStatsElement.innerHTML = `
                Contas conectadas: ${connectedAccounts.length} | 
                Eventos encontrados: ${totalEvents} | 
                PerÃ­odo: ${currentDate.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })} |
                Filtro: APENAS eventos com PAGAMENTO, PAGAMENTOS, HVC ou ENTRADA no TÃTULO
            `;
        }

        // =================================================================
        // âœ… NOVO: FILTROS PARA LISTAS SEPARADAS
        // =================================================================
        function initializePaymentFilters() {
            // Filtros para lista de pagamentos
            const nameFilterPag = document.getElementById('nameFilterPagamentos');
            const dateFilterPag = document.getElementById('dateFilterPagamentos');
            const statusFilterPag = document.getElementById('statusFilterPagamentos');
            const accountFilterPag = document.getElementById('accountFilterPagamentos');
            const clearFiltersPagBtn = document.getElementById('clearFiltersPagamentos');
            
            if (nameFilterPag) nameFilterPag.addEventListener('input', () => applyPaymentFilters('pagamentos'));
            if (dateFilterPag) dateFilterPag.addEventListener('change', () => applyPaymentFilters('pagamentos'));
            if (statusFilterPag) statusFilterPag.addEventListener('change', () => applyPaymentFilters('pagamentos'));
            if (accountFilterPag) accountFilterPag.addEventListener('change', () => applyPaymentFilters('pagamentos'));
            if (clearFiltersPagBtn) clearFiltersPagBtn.addEventListener('click', () => clearPaymentFilters('pagamentos'));

            // Filtros para lista de entradas
            const nameFilterEnt = document.getElementById('nameFilterEntradas');
            const dateFilterEnt = document.getElementById('dateFilterEntradas');
            const statusFilterEnt = document.getElementById('statusFilterEntradas');
            const accountFilterEnt = document.getElementById('accountFilterEntradas');
            const clearFiltersEntBtn = document.getElementById('clearFiltersEntradas');
            
            if (nameFilterEnt) nameFilterEnt.addEventListener('input', () => applyPaymentFilters('entradas'));
            if (dateFilterEnt) dateFilterEnt.addEventListener('change', () => applyPaymentFilters('entradas'));
            if (statusFilterEnt) statusFilterEnt.addEventListener('change', () => applyPaymentFilters('entradas'));
            if (accountFilterEnt) accountFilterEnt.addEventListener('change', () => applyPaymentFilters('entradas'));
            if (clearFiltersEntBtn) clearFiltersEntBtn.addEventListener('click', () => clearPaymentFilters('entradas'));
        }

        function applyPaymentFilters(type) {
            const nameFilter = document.getElementById(`nameFilter${type === 'pagamentos' ? 'Pagamentos' : 'Entradas'}`)?.value.toLowerCase() || '';
            const dateFilter = document.getElementById(`dateFilter${type === 'pagamentos' ? 'Pagamentos' : 'Entradas'}`)?.value || '';
            const statusFilter = document.getElementById(`statusFilter${type === 'pagamentos' ? 'Pagamentos' : 'Entradas'}`)?.value || '';
            const accountFilter = document.getElementById(`accountFilter${type === 'pagamentos' ? 'Pagamentos' : 'Entradas'}`)?.value || '';
            
            const separatedData = calculateSeparatedTotals(accountManager.getAllEvents());
            const sourceList = type === 'pagamentos' ? separatedData.pagamento.list : separatedData.entrada.list;
            
            const filteredList = sourceList.filter(payment => {
                const nameMatch = !nameFilter || 
                    payment.name.toLowerCase().includes(nameFilter) ||
                    payment.eventTitle.toLowerCase().includes(nameFilter);
                
                const dateMatch = !dateFilter || payment.date === dateFilter;
                
                const statusMatch = !statusFilter || payment.status === statusFilter;
                
                const accountMatch = !accountFilter || payment.account === accountFilter;
                
                return nameMatch && dateMatch && statusMatch && accountMatch;
            });
            
            updatePaymentsList(type === 'pagamentos' ? 'pagamentosList' : 'entradaList', filteredList);
        }

        function clearPaymentFilters(type) {
            document.getElementById(`nameFilter${type === 'pagamentos' ? 'Pagamentos' : 'Entradas'}`).value = '';
            document.getElementById(`dateFilter${type === 'pagamentos' ? 'Pagamentos' : 'Entradas'}`).value = '';
            document.getElementById(`statusFilter${type === 'pagamentos' ? 'Pagamentos' : 'Entradas'}`).value = '';
            document.getElementById(`accountFilter${type === 'pagamentos' ? 'Pagamentos' : 'Entradas'}`).value = '';
            
            applyPaymentFilters(type);
        }

        function updateAccountFilter() {
            const accounts = accountManager.getConnectedAccounts();
            const accountOptions = '<option value="">Todas as contas</option>' +
                accounts.map(account => 
                    `<option value="${account.email}">${account.email}</option>`
                ).join('');
            
            const accountFilterPag = document.getElementById('accountFilterPagamentos');
            const accountFilterEnt = document.getElementById('accountFilterEntradas');
            
            if (accountFilterPag) accountFilterPag.innerHTML = accountOptions;
            if (accountFilterEnt) accountFilterEnt.innerHTML = accountOptions;
        }

        function updatePaymentsList(containerId, paymentsList) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            if (paymentsList.length === 0) {
                container.innerHTML = `
                    <div class="no-payments">
                        <i class="fas fa-search"></i>
                        <p>Nenhum item encontrado</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = paymentsList.map(payment => `
                <div class="payment-item" style="border-left-color: ${payment.accountColor}" onclick="showPaymentEvent('${payment.eventId}')">
                    <div class="payment-header">
                        <div class="payment-name">${payment.name}</div>
                        <div class="payment-value">${payment.formattedValue}</div>
                    </div>
                    <div class="payment-details">
                        <div class="payment-date">
                            <i class="fas fa-calendar"></i>
                            ${payment.eventDate.toLocaleDateString('pt-BR')}
                        </div>
                        <div class="payment-status ${payment.status.toLowerCase()}">
                            <i class="fas fa-circle"></i>
                            ${payment.status}
                        </div>
                        <div class="payment-account">
                            <i class="fas fa-user"></i>
                            ${payment.accountEmail}
                        </div>
                        <div class="payment-type ${payment.eventType}">
                            <i class="fas fa-tag"></i>
                            ${payment.eventType.toUpperCase()}
                        </div>
                    </div>
                    <div style="margin-top: 8px; color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">
                        <i class="fas fa-calendar-alt"></i> ${payment.eventTitle}
                    </div>
                </div>
            `).join('');
        }

        function showPaymentEvent(eventId) {
            const allEvents = accountManager.getAllEvents();
            const event = allEvents.find(e => e.id === eventId);
            if (event) {
                showEventDetails(event);
            }
        }

        // =================================================================
        // NOVA LÃ“GICA DE CORES DOS EVENTOS
        // =================================================================
        function getEventGroupColor(type, events, date) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const eventDate = new Date(date);
            eventDate.setHours(0, 0, 0, 0);
            
            // Verificar se todos os itens estÃ£o completos
            let allItemsCompleted = true;
            let hasAnyItems = false;
            
            events.forEach(event => {
                const eventCalc = calculateEventTotal(event);
                if (eventCalc.payments.length > 0) {
                    hasAnyItems = true;
                    eventCalc.payments.forEach(item => {
                        if (type === 'pagamento') {
                            // Para pagamentos: deve ser PG ou RECALCULADO
                            if (item.status !== 'PG' && item.status !== 'RECALCULADO') {
                                allItemsCompleted = false;
                            }
                        } else if (type === 'entrada') {
                            // Para entradas: deve ser RC ou ADIADO
                            if (item.status !== 'RC' && item.status !== 'ADIADO') {
                                allItemsCompleted = false;
                            }
                        }
                    });
                }
            });
            
            // LÃ“GICA DE CORES:
            if (hasAnyItems && allItemsCompleted) {
                // VERDE: Todos os itens estÃ£o completos
                return {
                    background: 'rgba(52, 168, 83, 0.8)',
                    borderColor: '#34a853',
                    color: '#000'
                };
            } else if (eventDate >= today) {
                // AZUL: Eventos futuros (hoje em diante)
                return {
                    background: 'rgba(66, 133, 244, 0.8)',
                    borderColor: '#4285f4',
                    color: '#000'
                };
            } else {
                // VERMELHO: Eventos passados com pelo menos um item incompleto
                return {
                    background: 'rgba(234, 67, 53, 0.8)',
                    borderColor: '#ea4335',
                    color: '#000'
                };
            }
        }

        // =================================================================
        // CALENDAR RENDERING
        // =================================================================
        function renderCalendar(events) {
            const calendarGrid = document.getElementById('calendarGrid');
            if (!calendarGrid) return;

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // âœ… CORRIGIDO: CalendÃ¡rio comeÃ§ando na segunda-feira
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            // Calcular o primeiro dia da semana (segunda-feira = 1)
            let startDate = new Date(firstDay);
            const dayOfWeek = firstDay.getDay(); // 0 = domingo, 1 = segunda, etc.
            const daysToSubtract = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // Se domingo, voltar 6 dias
            startDate.setDate(firstDay.getDate() - daysToSubtract);
            
            // Atualizar tÃ­tulo do calendÃ¡rio
            const calendarTitle = document.getElementById('calendarTitle');
            if (calendarTitle) {
                calendarTitle.textContent = currentDate.toLocaleDateString('pt-BR', { 
                    month: 'long', 
                    year: 'numeric' 
                });
            }
            
            // Limpar grid e adicionar cabeÃ§alhos dos dias
            calendarGrid.innerHTML = '';
            
            // âœ… CORRIGIDO: CabeÃ§alhos comeÃ§ando na segunda-feira
            const dayHeaders = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'SÃ¡b', 'Dom'];
            dayHeaders.forEach(day => {
                const headerDiv = document.createElement('div');
                headerDiv.className = 'calendar-day-header';
                headerDiv.textContent = day;
                calendarGrid.appendChild(headerDiv);
            });
            
            // Renderizar 42 dias (6 semanas)
            for (let i = 0; i < 42; i++) {
                const cellDate = new Date(startDate);
                cellDate.setDate(startDate.getDate() + i);
                
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                
                // Marcar dias de outros meses
                if (cellDate.getMonth() !== month) {
                    dayDiv.classList.add('other-month');
                }
                
                // Marcar dia atual
                const today = new Date();
                if (cellDate.toDateString() === today.toDateString()) {
                    dayDiv.classList.add('today');
                }
                
                // NÃºmero do dia
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = cellDate.getDate();
                dayDiv.appendChild(dayNumber);
                
                // âœ… MODIFICADO: Totais separados do dia + SALDO
                const dayTotals = calculateDayTotal(cellDate, events);
                if (dayTotals.total > 0) {
                    const dayTotalsContainer = document.createElement('div');
                    dayTotalsContainer.className = 'day-totals-container';
                    
                    if (dayTotals.entrada > 0) {
                        const entradaTotalDiv = document.createElement('div');
                        entradaTotalDiv.className = 'day-total entrada-total';
                        entradaTotalDiv.textContent = `E: ${formatCurrency(dayTotals.entrada)}`;
                        entradaTotalDiv.style.background = 'rgba(128, 0, 128, 0.8)'; // ROXO para entradas
                        entradaTotalDiv.style.color = '#fff';
                        dayTotalsContainer.appendChild(entradaTotalDiv);
                    }
                    
                    if (dayTotals.pagamento > 0) {
                        const pagamentoTotalDiv = document.createElement('div');
                        pagamentoTotalDiv.className = 'day-total pagamento-total';
                        pagamentoTotalDiv.textContent = `P: ${formatCurrency(dayTotals.pagamento)}`;
                        pagamentoTotalDiv.style.background = 'rgba(139, 69, 19, 0.8)'; // MARROM para pagamentos
                        pagamentoTotalDiv.style.color = '#fff';
                        dayTotalsContainer.appendChild(pagamentoTotalDiv);
                    }
                    
                    // âœ… NOVO: Saldo do dia (Entradas - Pagamentos)
                    if (dayTotals.entrada > 0 || dayTotals.pagamento > 0) {
                        const saldo = dayTotals.entrada - dayTotals.pagamento;
                        const saldoDiv = document.createElement('div');
                        saldoDiv.className = 'day-total saldo-total';
                        saldoDiv.textContent = `S: ${formatCurrency(saldo)}`;
                        
                        if (saldo > 0) {
                            saldoDiv.style.background = 'rgba(255, 215, 0, 0.9)'; // AMARELO para saldo positivo
                            saldoDiv.style.color = '#000';
                        } else if (saldo < 0) {
                            saldoDiv.style.background = 'rgba(255, 165, 0, 0.9)'; // LARANJA para saldo negativo
                            saldoDiv.style.color = '#000';
                        } else {
                            saldoDiv.style.background = 'rgba(108, 117, 125, 0.8)'; // Cinza para saldo zero
                            saldoDiv.style.color = '#000';
                        }
                        
                        dayTotalsContainer.appendChild(saldoDiv);
                    }
                    
                    dayDiv.appendChild(dayTotalsContainer);
                }
                
                // âœ… MODIFICADO: Eventos agrupados do dia
                const dayEvents = document.createElement('div');
                dayEvents.className = 'day-events';
                
                const groupedEvents = getGroupedEventsForDay(cellDate, events);
                
                // Criar "eventÃ£o" de PAGAMENTOS se houver eventos de pagamento
                if (groupedEvents.pagamento.length > 0) {
                    const pagamentoEventDiv = document.createElement('div');
                    const pagamentoStyle = getEventGroupColor('pagamento', groupedEvents.pagamento, cellDate);
                    
                    pagamentoEventDiv.className = 'event-item pagamento-group';
                    pagamentoEventDiv.style.background = pagamentoStyle.background;
                    pagamentoEventDiv.style.color = pagamentoStyle.color;
                    pagamentoEventDiv.style.borderLeft = `4px solid ${pagamentoStyle.borderColor}`;
                    pagamentoEventDiv.textContent = `PAGAMENTOS (${groupedEvents.pagamento.length})`;
                    pagamentoEventDiv.onclick = () => showGroupedEventDetails('pagamento', groupedEvents.pagamento, cellDate);
                    dayEvents.appendChild(pagamentoEventDiv);
                }
                
                // Criar "eventÃ£o" de ENTRADAS se houver eventos de entrada
                if (groupedEvents.entrada.length > 0) {
                    const entradaEventDiv = document.createElement('div');
                    const entradaStyle = getEventGroupColor('entrada', groupedEvents.entrada, cellDate);
                    
                    entradaEventDiv.className = 'event-item entrada-group';
                    entradaEventDiv.style.background = entradaStyle.background;
                    entradaEventDiv.style.color = entradaStyle.color;
                    entradaEventDiv.style.borderLeft = `4px solid ${entradaStyle.borderColor}`;
                    entradaEventDiv.textContent = `ENTRADAS (${groupedEvents.entrada.length})`;
                    entradaEventDiv.onclick = () => showGroupedEventDetails('entrada', groupedEvents.entrada, cellDate);
                    dayEvents.appendChild(entradaEventDiv);
                }
                
                // Mostrar outros eventos individualmente (HVC, etc.)
                groupedEvents.outros.forEach(event => {
                    const eventDiv = document.createElement('div');
                    eventDiv.className = 'event-item';
                    eventDiv.textContent = event.summary || 'Sem tÃ­tulo';
                    eventDiv.onclick = () => showEventDetails(event);
                    dayEvents.appendChild(eventDiv);
                });
                
                dayDiv.appendChild(dayEvents);
                calendarGrid.appendChild(dayDiv);
            }
        }

        function getEventsForDay(date, events) {
            const targetDateString = getCalendarDateString(date);
            
            return events.filter(event => {
                const eventDate = parseEventDate(event);
                const eventDateString = getCalendarDateString(eventDate);
                
                return eventDateString === targetDateString;
            });
        }

        async function showEventDetails(event) {
            const modal = document.getElementById('eventModal');
            const title = document.getElementById('eventModalTitle');
            const body = document.getElementById('eventModalBody');
            
            if (!modal || !title || !body) return;
            
            title.textContent = event.summary || 'Sem tÃ­tulo';
            
            const eventDate = parseEventDate(event);
            const start = eventDate;
            const end = event.end.dateTime ? new Date(event.end.dateTime) : eventDate;
            
            const eventCalc = calculateEventTotal(event);
            
            let detailsHTML = `
                <p><strong><i class="fas fa-calendar"></i> Data:</strong> ${start.toLocaleDateString('pt-BR')}</p>
                <p><strong><i class="fas fa-clock"></i> HorÃ¡rio:</strong> ${event.start.dateTime ? 
                    `${start.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })} - ${end.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}` : 
                    'Dia inteiro'}</p>
                <p><strong><i class="fas fa-user"></i> Conta:</strong> 
                    <span style="color: ${event.accountColor || '#4285f4'}">${event.accountEmail || 'Conta desconhecida'}</span>
                </p>
                <div id="descriptionSection">
                    <p><strong><i class="fas fa-info-circle"></i> DescriÃ§Ã£o:</strong></p>
                    ${event.description ? `
                        <div id="descriptionDisplay" class="description-display">${event.description}</div>
                    ` : `
                        <div id="descriptionDisplay" class="description-display" style="color: rgba(255, 255, 255, 0.5); font-style: italic;">
                            Nenhuma descriÃ§Ã£o disponÃ­vel
                        </div>
                    `}
                    <button onclick="startEditingDescription('${event.id}')" class="btn-edit">
                        <i class="fas fa-edit"></i> ${event.description ? 'Editar DescriÃ§Ã£o' : 'Adicionar DescriÃ§Ã£o'}
                    </button>
                </div>
                ${event.location ? `<p><strong><i class="fas fa-map-marker-alt"></i> Local:</strong> ${event.location}</p>` : ''}
                <p><strong><i class="fas fa-tag"></i> Tipo:</strong> ${getEventType(event).toUpperCase()}</p>
            `;
            
            if (eventCalc.count > 0) {
                detailsHTML += `
                    <div class="event-total-section">
                        <div class="event-total-title">
                            <i class="fas fa-calculator"></i> TOTAL CONTABILIZADO (PG + PENDENTE)
                        </div>
                        <div class="event-total-value">
                            ${formatCurrency(eventCalc.total)}
                        </div>
                    </div>
                    
                    <div class="event-values-list">
                        <h4><i class="fas fa-list"></i> Valores Encontrados (${eventCalc.count})</h4>
                        ${eventCalc.payments.map(payment => `
                            <div class="value-item">
                                <span>${payment.name} - ${payment.formattedValue}</span>
                                <span class="value-item-status ${payment.status.toLowerCase()}">${payment.status}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                detailsHTML += `
                    <div style="text-align: center; padding: 20px; color: rgba(255, 255, 255, 0.6);">
                        <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>Nenhum valor monetÃ¡rio encontrado neste evento</p>
                    </div>
                `;
            }

            // âœ… NOVO: SeÃ§Ã£o de anexos PDF
            detailsHTML += `
                <div class="event-attachments-section">
                    <h4><i class="fas fa-paperclip"></i> Anexos PDF</h4>
                    <div id="eventAttachmentsList" class="event-attachments-list">
                        <!-- Lista de anexos serÃ¡ carregada aqui -->
                    </div>
                    <div class="attachment-upload-section">
                        <input type="file" id="eventPdfInput" multiple accept=".pdf" style="display: none;">
                        <button onclick="document.getElementById('eventPdfInput').click()" class="btn-add-pdf">
                            <i class="fas fa-plus"></i> Adicionar PDF
                        </button>
                    </div>
                </div>
            `;
            
            body.innerHTML = detailsHTML;

            // âœ… NOVO: Configurar upload de PDFs para este evento
            setupEventPdfUpload(event);
            
            // âœ… NOVO: Carregar anexos existentes
            loadEventAttachments(event);
            
            modal.style.display = 'block';
        }

        // âœ… NOVO: FunÃ§Ã£o para mostrar detalhes de eventos agrupados
        async function showGroupedEventDetails(type, events, date) {
            const modal = document.getElementById('eventModal');
            const title = document.getElementById('eventModalTitle');
            const body = document.getElementById('eventModalBody');
            
            if (!modal || !title || !body) return;
            
            const typeLabel = type === 'pagamento' ? 'PAGAMENTOS' : 'ENTRADAS';
            const typeColor = type === 'pagamento' ? '#ea4335' : '#28a745';
            
            title.textContent = `${typeLabel} - ${date.toLocaleDateString('pt-BR')}`;
            
            let totalGeral = 0;
            let totalItens = 0;
            
            let detailsHTML = `
                <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: rgba(${type === 'pagamento' ? '234, 67, 53' : '40, 167, 69'}, 0.1); border-radius: 8px; border: 2px solid ${typeColor};">
                    <h3 style="color: ${typeColor}; margin: 0;">
                        <i class="fas fa-${type === 'pagamento' ? 'credit-card' : 'plus-circle'}"></i> 
                        ${typeLabel} DO DIA
                    </h3>
                    <p style="margin: 5px 0; color: rgba(255, 255, 255, 0.8);">
                        ${events.length} evento${events.length > 1 ? 's' : ''} encontrado${events.length > 1 ? 's' : ''}
                    </p>
                </div>
                
                <div class="grouped-events-list">
            `;
            
            events.forEach((event, index) => {
                const eventCalc = calculateEventTotal(event);
                totalGeral += eventCalc.total;
                totalItens += eventCalc.count;
                
                const eventDate = parseEventDate(event);
                const start = eventDate;
                const end = event.end.dateTime ? new Date(event.end.dateTime) : eventDate;
                
                detailsHTML += `
                    <div class="grouped-event-item" style="border-left: 4px solid ${typeColor}; margin-bottom: 20px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                        <div class="grouped-event-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4 style="margin: 0; color: ${typeColor};">
                                <i class="fas fa-calendar-alt"></i> ${event.summary || 'Sem tÃ­tulo'}
                            </h4>
                            <span style="background: ${typeColor}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">
                                ${formatCurrency(eventCalc.total)}
                            </span>
                        </div>
                        
                        <p style="margin: 5px 0; color: rgba(255, 255, 255, 0.7);">
                            <i class="fas fa-clock"></i> ${event.start.dateTime ? 
                                `${start.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })} - ${end.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}` : 
                                'Dia inteiro'}
                        </p>
                        
                        <p style="margin: 5px 0; color: rgba(255, 255, 255, 0.7);">
                            <i class="fas fa-user"></i> <span style="color: ${event.accountColor || '#4285f4'}">${event.accountEmail || 'Conta desconhecida'}</span>
                        </p>
                        
                        ${eventCalc.count > 0 ? `
                            <div class="event-values-mini" style="margin-top: 10px;">
                                <strong style="color: ${typeColor};">
                                    <i class="fas fa-list"></i> ${eventCalc.count} item${eventCalc.count > 1 ? 'ns' : ''}:
                                </strong>
                                <div style="margin-top: 5px;">
                                    ${eventCalc.payments.map(payment => `
                                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 3px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                            <span style="color: rgba(255, 255, 255, 0.9);">${payment.name}</span>
                                            <div>
                                                <span style="color: white; margin-right: 8px;">${payment.formattedValue}</span>
                                                <span class="value-item-status ${payment.status.toLowerCase()}" style="font-size: 0.7rem;">${payment.status}</span>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : `
                            <p style="color: rgba(255, 255, 255, 0.5); font-style: italic; margin-top: 10px;">
                                <i class="fas fa-info-circle"></i> Nenhum valor encontrado
                            </p>
                        `}
                        
                        <button onclick="showEventDetails(${JSON.stringify(event).replace(/"/g, '&quot;')})" 
                                class="btn-edit" style="margin-top: 10px; background: ${typeColor};">
                            <i class="fas fa-eye"></i> Ver Detalhes
                        </button>
                    </div>
                `;
            });
            
            detailsHTML += `
                </div>
                
                <div style="text-align: center; margin-top: 20px; padding: 15px; background: rgba(${type === 'pagamento' ? '234, 67, 53' : '40, 167, 69'}, 0.2); border-radius: 8px;">
                    <h3 style="color: ${typeColor}; margin: 0 0 10px 0;">
                        <i class="fas fa-calculator"></i> RESUMO TOTAL
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: ${typeColor};">
                                ${formatCurrency(totalGeral)}
                            </div>
                            <div style="color: rgba(255, 255, 255, 0.8); font-size: 0.9rem;">
                                Valor Total
                            </div>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: ${typeColor};">
                                ${totalItens}
                            </div>
                            <div style="color: rgba(255, 255, 255, 0.8); font-size: 0.9rem;">
                                Total de Itens
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            body.innerHTML = detailsHTML;
            modal.style.display = 'block';
        }

        // =================================================================
        // EDIÃ‡ÃƒO DE DESCRIÃ‡ÃƒO DE EVENTOS
        // =================================================================
        function startEditingDescription(eventId) {
            editingEventId = eventId;
            const allEvents = accountManager.getAllEvents();
            const event = allEvents.find(e => e.id === eventId);
            
            if (!event) {
                showMessage('Evento nÃ£o encontrado', 'error');
                return;
            }
            
            const descriptionSection = document.getElementById('descriptionSection');
            if (!descriptionSection) return;
            
            const currentDescription = event.description || '';
            
            descriptionSection.innerHTML = `
                <p><strong><i class="fas fa-info-circle"></i> DescriÃ§Ã£o:</strong></p>
                <div class="description-edit-container">
                    <textarea 
                        id="editDescriptionTextarea" 
                        class="description-edit-textarea" 
                        placeholder="Digite a descriÃ§Ã£o do evento..."
                    >${currentDescription}</textarea>
                    <div class="description-edit-buttons">
                        <button onclick="saveEventDescription()" class="btn-edit btn-save" id="saveDescriptionBtn">
                            <i class="fas fa-save"></i> Salvar
                        </button>
                        <button onclick="cancelEditingDescription()" class="btn-edit btn-cancel" id="cancelDescriptionBtn">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </div>
            `;
            
            // Focar no textarea
            const textarea = document.getElementById('editDescriptionTextarea');
            if (textarea) {
                textarea.focus();
                textarea.setSelectionRange(textarea.value.length, textarea.value.length);
            }
        }

        function cancelEditingDescription() {
            if (!editingEventId) return;
            
            const allEvents = accountManager.getAllEvents();
            const event = allEvents.find(e => e.id === editingEventId);
            
            if (!event) return;
            
            const descriptionSection = document.getElementById('descriptionSection');
            if (!descriptionSection) return;
            
            descriptionSection.innerHTML = `
                <p><strong><i class="fas fa-info-circle"></i> DescriÃ§Ã£o:</strong></p>
                ${event.description ? `
                    <div id="descriptionDisplay" class="description-display">${event.description}</div>
                ` : `
                    <div id="descriptionDisplay" class="description-display" style="color: rgba(255, 255, 255, 0.5); font-style: italic;">
                        Nenhuma descriÃ§Ã£o disponÃ­vel
                    </div>
                `}
                <button onclick="startEditingDescription('${event.id}')" class="btn-edit">
                    <i class="fas fa-edit"></i> ${event.description ? 'Editar DescriÃ§Ã£o' : 'Adicionar DescriÃ§Ã£o'}
                </button>
            `;
            
            editingEventId = null;
        }

        async function saveEventDescription() {
            if (!editingEventId) return;
            
            const textarea = document.getElementById('editDescriptionTextarea');
            const saveBtn = document.getElementById('saveDescriptionBtn');
            const cancelBtn = document.getElementById('cancelDescriptionBtn');
            
            if (!textarea) return;
            
            const newDescription = textarea.value.trim();
            
            // Desabilitar botÃµes durante o salvamento
            if (saveBtn) saveBtn.disabled = true;
            if (cancelBtn) cancelBtn.disabled = true;
            
            try {
                // Atualizar evento via API do Google Calendar
                const response = await gapi.client.calendar.events.patch({
                    calendarId: 'primary',
                    eventId: editingEventId,
                    resource: {
                        description: newDescription
                    }
                });
                
                if (response.status === 200) {
                    // Atualizar evento localmente
                    const allEvents = accountManager.getAllEvents();
                    const eventIndex = allEvents.findIndex(e => e.id === editingEventId);
                    
                    if (eventIndex !== -1) {
                        allEvents[eventIndex].description = newDescription;
                        
                        // Atualizar no gerenciador de contas
                        accountManager.accounts.forEach(account => {
                            const accountEventIndex = account.events.findIndex(e => e.id === editingEventId);
                            if (accountEventIndex !== -1) {
                                account.events[accountEventIndex].description = newDescription;
                            }
                        });
                        
                        accountManager.saveToStorage();
                    }
                    
                    showMessage('DescriÃ§Ã£o atualizada com sucesso!', 'success');
                    
                    // Atualizar interface
                    cancelEditingDescription();
                    updateAllData();
                    
                } else {
                    throw new Error('Erro ao salvar no Google Calendar');
                }
                
            } catch (error) {
                console.error('âŒ Erro ao salvar descriÃ§Ã£o:', error);
                showMessage('Erro ao salvar descriÃ§Ã£o: ' + error.message, 'error');
                
                // Reabilitar botÃµes
                if (saveBtn) saveBtn.disabled = false;
                if (cancelBtn) cancelBtn.disabled = false;
            }
        }

        // Adicionar listener para Enter+Ctrl no textarea
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey && event.key === 'Enter') {
                const textarea = document.getElementById('editDescriptionTextarea');
                if (textarea && document.activeElement === textarea) {
                    saveEventDescription();
                }
            } else if (event.key === 'Escape') {
                const textarea = document.getElementById('editDescriptionTextarea');
                if (textarea && document.activeElement === textarea) {
                    cancelEditingDescription();
                }
            }
        });

        // =================================================================
        // CALENDAR NAVIGATION
        // =================================================================
        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            const allEvents = accountManager.getAllEvents();
            renderCalendar(allEvents);
            updateMonthlySummary(allEvents);
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            const allEvents = accountManager.getAllEvents();
            renderCalendar(allEvents);
            updateMonthlySummary(allEvents);
        }

        function goToToday() {
            currentDate = new Date();
            const allEvents = accountManager.getAllEvents();
            renderCalendar(allEvents);
            updateMonthlySummary(allEvents);
        }

        // =================================================================
        // UTILITY FUNCTIONS
        // =================================================================
        function getEventType(event) {
            const summary = (event.summary || '').toLowerCase();
            const description = (event.description || '').toLowerCase();
            const fullText = `${summary} ${description}`;
            
            if (fullText.includes('entrada')) return 'entrada';
            if (fullText.includes('hvc')) return 'hvc';
            if (fullText.includes('pagamento') || fullText.includes('pagar')) return 'pagamento';
            return 'evento';
        }

        function parseEventDate(event) {
            if (event.start) {
                if (event.start.dateTime) {
                    return new Date(event.start.dateTime);
                } else if (event.start.date) {
                    return new Date(event.start.date + 'T00:00:00');
                }
            }
            return new Date();
        }

        function getCalendarDateString(date) {
            return date.getFullYear() + '-' + 
                   String(date.getMonth() + 1).padStart(2, '0') + '-' + 
                   String(date.getDate()).padStart(2, '0');
        }

        // =================================================================
        // MODAL MANAGEMENT
        // =================================================================
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
            
            // Limpar estado de ediÃ§Ã£o se modal for fechado
            if (modalId === 'eventModal') {
                editingEventId = null;
            }
        }

        // =================================================================
        // MESSAGE SYSTEM
        // =================================================================
        function showMessage(text, type = 'info') {
            const container = document.getElementById('messagesContainer');
            if (!container) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const icon = type === 'success' ? 'fa-check-circle' :
                        type === 'error' ? 'fa-exclamation-circle' :
                        type === 'warning' ? 'fa-exclamation-triangle' :
                        'fa-info-circle';
            
            messageDiv.innerHTML = `
                <i class="fas ${icon}"></i>
                <span>${text}</span>
            `;
            
            container.appendChild(messageDiv);
            
            // Auto-remove apÃ³s 5 segundos
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 5000);
        }

        // =================================================================
        // EVENT LISTENERS
        // =================================================================
        window.onclick = function(event) {
            const eventModal = document.getElementById('eventModal');
            if (event.target === eventModal) {
                eventModal.style.display = 'none';
                editingEventId = null;
            }
        }

        // =================================================================
        // âœ… NOVO: FUNÃ‡Ã•ES DE CRIAÃ‡ÃƒO DE EVENTOS (copiadas da pÃ¡gina do usuÃ¡rio)
        // =================================================================

        // âœ… NOVO: Atualizar opÃ§Ãµes de status baseado no tipo de evento
        function updateStatusOptions() {
            const eventType = document.getElementById('eventType').value;
            const statusSelect = document.getElementById('itemStatus');
            
            // Limpar opÃ§Ãµes existentes
            statusSelect.innerHTML = '';
            
            if (eventType === 'PAGAMENTO') {
                // OpÃ§Ãµes para PAGAMENTO
                statusSelect.innerHTML = `
                    <option value="PENDENTE">PENDENTE</option>
                    <option value="PG">PG</option>
                    <option value="RECALCULADO">RECALCULADO</option>
                `;
            } else if (eventType === 'ENTRADA') {
                // OpÃ§Ãµes para ENTRADA
                statusSelect.innerHTML = `
                    <option value="AGUARDANDO">AGUARDANDO</option>
                    <option value="RC">RC</option>
                    <option value="ADIADO">ADIADO</option>
                `;
            }
        }

        // âœ… NOVO: Carregar calendÃ¡rios disponÃ­veis
        async function loadAvailableCalendars() {
            try {
                const response = await gapi.client.calendar.calendarList.list();
                const calendars = response.result.items;
                
                const calendarSelect = document.getElementById('eventCalendar');
                calendarSelect.innerHTML = ''; // Limpar opÃ§Ãµes existentes
                
                calendars.forEach(calendar => {
                    const option = document.createElement('option');
                    option.value = calendar.id;
                    option.textContent = calendar.summary;
                    
                    // Marcar calendÃ¡rio principal como padrÃ£o
                    if (calendar.primary) {
                        option.selected = true;
                        option.textContent += ' (Principal)';
                    }
                    
                    calendarSelect.appendChild(option);
                });
                
                console.log(`${calendars.length} calendÃ¡rios carregados`);
            } catch (error) {
                console.error('Erro ao carregar calendÃ¡rios:', error);
                // Manter opÃ§Ã£o padrÃ£o se houver erro
                const calendarSelect = document.getElementById('eventCalendar');
                if (calendarSelect.children.length === 0) {
                    calendarSelect.innerHTML = '<option value="primary">CalendÃ¡rio Principal</option>';
                }
            }
        }

        // Mostrar/ocultar seÃ§Ã£o de criaÃ§Ã£o de eventos
        function showEventCreator() {
            const section = document.getElementById('eventCreatorSection');
            section.style.display = section.style.display === 'none' ? 'block' : 'none';
            
            if (section.style.display === 'block') {
                // Limpar formulÃ¡rio
                clearItemForm();
                paymentItems = [];
                renderPaymentItems();
                document.getElementById('createEventForm').style.display = 'none';
                
                // âœ… NOVO: Carregar calendÃ¡rios quando abrir a seÃ§Ã£o
                loadAvailableCalendars();
            }
        }

        // Adicionar item de pagamento
        function addPaymentItem() {
            const tipo = document.getElementById('itemTipo').value.trim();
            const subtipo = document.getElementById('itemSubtipo').value.trim();
            const categoria = document.getElementById('itemCategoria').value.trim();
            const nome = document.getElementById('itemNome').value.trim();
            
            // âœ… NOVO: Parsing correto do valor formatado
            const valorText = document.getElementById('itemValor').value;
            const valor = parseFloat(valorText.replace(/[^\d,]/g, '').replace(',', '.'));
            
            const status = document.getElementById('itemStatus').value;
            const detalhe = document.getElementById('itemDetalhe').value.trim();

            // ValidaÃ§Ã£o
            if (!nome) {
                alert('Nome do item Ã© obrigatÃ³rio!');
                return;
            }
            if (!valor || valor <= 0) {
                alert('Valor deve ser maior que zero!');
                return;
            }

            // Criar item
            const item = {
                id: Date.now(),
                tipo,
                subtipo,
                categoria,
                nome,
                valor,
                status,
                detalhe
            };

            paymentItems.push(item);
            renderPaymentItems();
            clearItemForm();
            
            // Mostrar formulÃ¡rio de evento se houver itens
            if (paymentItems.length > 0) {
                document.getElementById('createEventForm').style.display = 'block';
            }
        }

        // Remover item de pagamento
        function removePaymentItem(itemId) {
            paymentItems = paymentItems.filter(item => item.id !== itemId);
            renderPaymentItems();
            
            // Esconder formulÃ¡rio de evento se nÃ£o houver itens
            if (paymentItems.length === 0) {
                document.getElementById('createEventForm').style.display = 'none';
            }
        }

        // Renderizar lista de itens
        function renderPaymentItems() {
            const container = document.getElementById('itemsList');
            
            if (paymentItems.length === 0) {
                container.innerHTML = '<p style="color: rgba(255, 255, 255, 0.6); text-align: center; padding: 20px;">Nenhum item adicionado</p>';
                return;
            }
            
            container.innerHTML = paymentItems.map(item => `
                <div class="payment-item">
                    <div class="item-info">
                        <strong>${item.nome}</strong>
                        ${item.tipo ? ` - ${item.tipo}` : ''}
                        ${item.subtipo ? ` - ${item.subtipo}` : ''}
                        ${item.categoria ? ` - ${item.categoria}` : ''}
                        ${item.status ? ` (${item.status})` : ''}
                        ${item.detalhe ? ` - ${item.detalhe}` : ''}
                    </div>
                    <div class="item-value">${formatCurrency(item.valor)}</div>
                    <button onclick="removePaymentItem(${item.id})" class="remove-item-btn">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }

        // Limpar formulÃ¡rio de item
        function clearItemForm() {
            document.getElementById('itemTipo').value = '';
            document.getElementById('itemSubtipo').value = '';
            document.getElementById('itemCategoria').value = '';
            document.getElementById('itemNome').value = '';
            document.getElementById('itemValor').value = '';
            document.getElementById('itemStatus').value = '';
            document.getElementById('itemDetalhe').value = '';
        }

        // Criar evento de pagamento
        async function createPaymentEvent() {
            if (paymentItems.length === 0) {
                alert('Adicione pelo menos um item!');
                return;
            }

            const eventDate = document.getElementById('eventDate').value;
            const eventTime = document.getElementById('eventTime').value;
            const recurrence = document.getElementById('eventRecurrence').value;
            const eventType = document.getElementById('eventType').value; // âœ… NOVO
            const calendarId = document.getElementById('eventCalendar').value; // âœ… NOVO

            if (!eventDate) {
                alert('Selecione uma data para o evento!');
                return;
            }

            try {
                // Preparar descriÃ§Ã£o do evento
                let description = '';
                
                paymentItems.forEach(item => {
                    const parts = [item.tipo, item.subtipo, item.categoria, item.nome];
                    const itemDescription = parts.filter(p => p).join(' - ');
                    const valorFormatado = formatCurrency(item.valor);
                    const statusPart = item.status ? ` (${item.status})` : '';
                    const detalhePart = item.detalhe ? ` - ${item.detalhe}` : '';
                    
                    description += `${itemDescription} - ${valorFormatado}${statusPart}${detalhePart}\\n`;
                });

                // Preparar data/hora do evento
                const startDateTime = new Date(`${eventDate}T${eventTime}`);
                const endDateTime = new Date(startDateTime.getTime() + 60 * 60 * 1000); // +1 hora

                // Preparar recorrÃªncia
                let recurrenceRule = null;
                if (recurrence !== 'NONE') {
                    switch (recurrence) {
                        case 'DAILY':
                            recurrenceRule = ['RRULE:FREQ=DAILY'];
                            break;
                        case 'WEEKLY':
                            recurrenceRule = ['RRULE:FREQ=WEEKLY'];
                            break;
                        case 'MONTHLY':
                            recurrenceRule = ['RRULE:FREQ=MONTHLY'];
                            break;
                        case 'YEARLY':
                            recurrenceRule = ['RRULE:FREQ=YEARLY'];
                            break;
                        case 'WEEKDAYS':
                            recurrenceRule = ['RRULE:FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR'];
                            break;
                    }
                }

                // âœ… NOVO: Criar evento com tipo selecionado
                const event = {
                    summary: eventType, // Usa o tipo selecionado (PAGAMENTO ou ENTRADA)
                    description: description.trim(),
                    start: {
                        dateTime: startDateTime.toISOString(),
                        timeZone: 'America/Sao_Paulo'
                    },
                    end: {
                        dateTime: endDateTime.toISOString(),
                        timeZone: 'America/Sao_Paulo'
                    }
                };

                if (recurrenceRule) {
                    event.recurrence = recurrenceRule;
                }

                // âœ… NOVO: Criar evento no calendÃ¡rio selecionado
                const response = await gapi.client.calendar.events.insert({
                    calendarId: calendarId, // Usa o calendÃ¡rio selecionado
                    resource: event
                });

                if (response.status === 200) {
                    alert(`Evento de ${eventType} criado com sucesso no calendÃ¡rio selecionado!`);
                    
                    // Limpar formulÃ¡rio
                    paymentItems = [];
                    renderPaymentItems();
                    document.getElementById('createEventForm').style.display = 'none';
                    document.getElementById('eventCreatorSection').style.display = 'none';
                    
                    // Recarregar eventos
                    await loadEventsForAccount();
                } else {
                    throw new Error('Erro ao criar evento');
                }

            } catch (error) {
                console.error('Erro ao criar evento:', error);
                alert('Erro ao criar evento: ' + error.message);
            }
        }

        // Cancelar criaÃ§Ã£o de evento
        function cancelEventCreation() {
            paymentItems = [];
            renderPaymentItems();
            document.getElementById('createEventForm').style.display = 'none';
            document.getElementById('eventCreatorSection').style.display = 'none';
        }

        // Manipular mudanÃ§a de recorrÃªncia
        function handleRecurrenceChange() {
            const select = document.getElementById('eventRecurrence');
            if (select.value === 'CUSTOM') {
                alert('Funcionalidade de recorrÃªncia personalizada serÃ¡ implementada em breve!');
                select.value = 'NONE';
            }
        }

        // Event listeners para criaÃ§Ã£o de eventos
        document.addEventListener('DOMContentLoaded', function() {
            // BotÃ£o adicionar item
            const addItemBtn = document.getElementById('addItemBtn');
            if (addItemBtn) {
                addItemBtn.addEventListener('click', addPaymentItem);
            }
            
            // BotÃ£o criar evento
            const createEventBtn = document.getElementById('createEventBtn');
            if (createEventBtn) {
                createEventBtn.addEventListener('click', createPaymentEvent);
            }
            
            // BotÃ£o cancelar evento
            const cancelEventBtn = document.getElementById('cancelEventBtn');
            if (cancelEventBtn) {
                cancelEventBtn.addEventListener('click', cancelEventCreation);
            }
            
            // âœ… NOVO: Event listener para tipo de evento
            const eventTypeSelect = document.getElementById('eventType');
            if (eventTypeSelect) {
                eventTypeSelect.addEventListener('change', updateStatusOptions);
                // Inicializar com opÃ§Ãµes padrÃ£o
                updateStatusOptions();
            }
            
            // Permitir Enter para adicionar item
            const itemForm = document.querySelector('.add-item-form');
            if (itemForm) {
                itemForm.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addPaymentItem();
                    }
                });
            }
        });

        // =================================================================
        // INICIALIZAÃ‡ÃƒO
        // =================================================================
        document.addEventListener('DOMContentLoaded', function() {
            
            renderCalendar([]);
            initializePaymentFilters();
            updateAccountFilter();
            updateAccountsList();
        });

        // =================================================================
        // âœ… NOVO: FUNÃ‡Ã•ES PARA GERENCIAR ANEXOS PDF
        // =================================================================
        
        // VariÃ¡vel global para o evento atual
        let currentEventForPdf = null;

        // FunÃ§Ã£o para carregar anexos do evento (copiada do usuÃ¡rio)
        async function loadEventAttachments(event) {
            const attachmentsList = document.getElementById('eventAttachmentsList');
            if (!attachmentsList) return;
            
            try {
                // Buscar evento completo com anexos
                const fullEventResponse = await gapi.client.calendar.events.get({
                    calendarId: 'primary',
                    eventId: event.id
                });
                
                const fullEvent = fullEventResponse.result;
                
                if (fullEvent.attachments && fullEvent.attachments.length > 0) {
                    const attachmentsHTML = fullEvent.attachments.map(attachment => `
                        <div class="attachment-item">
                            <div class="attachment-info">
                                <i class="fas fa-file-pdf"></i>
                                <span class="attachment-name">${attachment.title || 'Anexo'}</span>
                            </div>
                            <div class="attachment-actions">
                                <button onclick="window.open('${attachment.fileUrl}', '_blank')" class="btn-view-attachment" title="Visualizar">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button onclick="removeAttachmentFromEvent('${event.id}', '${attachment.fileId}')" class="btn-remove-attachment" title="Remover">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `).join('');
                    
                    attachmentsList.innerHTML = attachmentsHTML;
                } else {
                    attachmentsList.innerHTML = '<p class="no-attachments">Nenhum anexo encontrado</p>';
                }
                
            } catch (error) {
                console.error('Erro ao carregar anexos:', error);
                attachmentsList.innerHTML = '<p class="no-attachments">Erro ao carregar anexos</p>';
            }
        }

        // FunÃ§Ã£o para configurar upload de PDFs (copiada do usuÃ¡rio)
        function setupEventPdfUpload(event) {
            currentEventForPdf = event;
            
            const pdfInput = document.getElementById('eventPdfInput');
            if (!pdfInput) return;
            
            pdfInput.onchange = async function(e) {
                const files = Array.from(e.target.files);
                
                for (const file of files) {
                    if (file.type !== 'application/pdf') {
                        alert(`${file.name} nÃ£o Ã© um arquivo PDF vÃ¡lido.`);
                        continue;
                    }
                    
                    try {
                        console.log(`Fazendo upload de ${file.name}...`);
                        
                        // Converter arquivo para base64
                        const base64Data = await convertFileToBase64(file);
                        
                        // Upload para Google Drive
                        const driveFile = await uploadToGoogleDrive(file.name, base64Data);
                        console.log('Arquivo enviado para o Drive:', driveFile);
                        
                        // Atualizar evento com novo anexo
                        await addAttachmentToEvent(event.id, driveFile);
                        
                        // Recarregar anexos
                        await loadEventAttachments(event);
                        
                        alert(`${file.name} anexado com sucesso!`);
                        
                    } catch (error) {
                        console.error('Erro no upload:', error);
                        throw error;
                    }
                }
                
                // Limpar input
                e.target.value = '';
            };
        }

        // FunÃ§Ã£o para converter arquivo para base64 (copiada do usuÃ¡rio)
        function convertFileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const base64String = reader.result.split(',')[1]; // Remove o prefixo data:...;base64,
                    resolve(base64String);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // FunÃ§Ã£o para fazer upload para Google Drive (copiada do usuÃ¡rio)
        async function uploadToGoogleDrive(fileName, base64Data) {
            try {
                const boundary = '-------314159265358979323846';
                const delimiter = "\r\n--" + boundary + "\r\n";
                const close_delim = "\r\n--" + boundary + "--";

                const metadata = {
                    'name': fileName,
                    'parents': [] // Opcional: especificar pasta
                };

                const multipartRequestBody =
                    delimiter +
                    'Content-Type: application/json\r\n\r\n' +
                    JSON.stringify(metadata) +
                    delimiter +
                    'Content-Type: application/pdf\r\n' +
                    'Content-Transfer-Encoding: base64\r\n' +
                    '\r\n' +
                    base64Data +
                    close_delim;

                const request = gapi.client.request({
                    'path': 'https://www.googleapis.com/upload/drive/v3/files',
                    'method': 'POST',
                    'params': {'uploadType': 'multipart'},
                    'headers': {
                        'Content-Type': 'multipart/related; boundary="' + boundary + '"'
                    },
                    'body': multipartRequestBody
                });

                const response = await request;
                return response.result;
                
            } catch (error) {
                console.error('Erro no upload para Google Drive:', error);
                throw error;
            }
        }

        // FunÃ§Ã£o para adicionar anexo ao evento (copiada do usuÃ¡rio)
        async function addAttachmentToEvent(eventId, driveFile) {
            try {
                // Buscar evento atual
                const eventResponse = await gapi.client.calendar.events.get({
                    calendarId: 'primary',
                    eventId: eventId
                });
                
                const event = eventResponse.result;
                
                // Adicionar novo anexo
                if (!event.attachments) {
                    event.attachments = [];
                }
                
                event.attachments.push({
                    fileId: driveFile.id,
                    fileUrl: `https://drive.google.com/file/d/${driveFile.id}/view`,
                    title: driveFile.name
                });
                
                // Atualizar evento
                await gapi.client.calendar.events.update({
                    calendarId: 'primary',
                    eventId: eventId,
                    resource: event,
                    supportsAttachments: true
                });
                
                console.log('âœ… Anexo adicionado ao evento');
                
            } catch (error) {
                console.error('Erro ao adicionar anexo ao evento:', error);
                throw error;
            }
        }

        // FunÃ§Ã£o para remover anexo do evento (copiada do usuÃ¡rio)
        async function removeAttachmentFromEvent(eventId, fileId) {
            if (!confirm('Tem certeza que deseja remover este anexo?')) return;
            
            try {
                // Buscar evento atual
                const eventResponse = await gapi.client.calendar.events.get({
                    calendarId: 'primary',
                    eventId: eventId
                });
                
                const event = eventResponse.result;
                
                // Remover anexo da lista
                if (event.attachments) {
                    event.attachments = event.attachments.filter(att => att.fileId !== fileId);
                }
                
                // Atualizar evento
                await gapi.client.calendar.events.update({
                    calendarId: 'primary',
                    eventId: eventId,
                    resource: event,
                    supportsAttachments: true
                });
                
                // Recarregar anexos
                await loadEventAttachments(currentEventForPdf);
                
                alert('Anexo removido com sucesso!');
                
            } catch (error) {
                console.error('Erro ao remover anexo:', error);
                alert('Erro ao remover anexo');
            }
        }

    </script>
</head>

<body>
    <div id="main-content-fluxo-caixa-hvc">
        <!-- Messages Container -->
        <div id="messagesContainer"></div>

        <!-- Header -->
        <div class="hvc-container">
            <h1 class="hvc-title">
                <i class="fas fa-chart-line"></i>
                Fluxo de Caixa HVC - Agenda e Pagamentos (Multi-Conta)
            </h1>
        </div>

        <!-- Gerenciamento de MÃºltiplas Contas -->
        <div class="accounts-section">
            <h2><i class="fab fa-google"></i> Contas do Google Calendar</h2>
            
            <div id="accountsList" class="accounts-list">
                <!-- Lista de contas serÃ¡ renderizada aqui -->
            </div>

            <div class="add-account-section">
                <button onclick="handleAddAccount()" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Adicionar Nova Conta
                </button>
                <button onclick="syncAllAccounts()" class="btn btn-secondary">
                    <i class="fas fa-sync-alt"></i> Sincronizar Todas
                </button>
            </div>
        </div>

        <!-- âœ… NOVO: SeÃ§Ã£o de CriaÃ§Ã£o de Eventos (copiada da pÃ¡gina do usuÃ¡rio) -->
        <div id="eventCreatorSection" class="event-creator-section" style="display: none;">
            <h3><i class="fas fa-plus-circle"></i> Criar Evento de Pagamento</h3>
            
            <!-- Lista de Itens de Pagamento -->
            <div class="payment-items-container">
                <h4><i class="fas fa-list"></i> Itens de Pagamento</h4>
                
                <!-- FormulÃ¡rio para Adicionar Item -->
                <div class="add-item-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Tipo</label>
                            <input type="text" id="itemTipo" placeholder="Ex: Despesa, Investimento...">
                        </div>
                        <div class="form-group">
                            <label>Subtipo</label>
                            <input type="text" id="itemSubtipo" placeholder="Ex: Fixa, VariÃ¡vel...">
                        </div>
                        <div class="form-group">
                            <label>Categoria</label>
                            <input type="text" id="itemCategoria" placeholder="Ex: AlimentaÃ§Ã£o, Transporte...">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nome do Item *</label>
                            <input type="text" id="itemNome" placeholder="Nome do item (obrigatÃ³rio)" required>
                        </div>
                        <div class="form-group">
                            <label>Valor *</label>
                            <input type="text" id="itemValor" placeholder="R$ 0,00" required>
                        </div>
                        <div class="form-group">
                            <label>Status</label>
                            <select id="itemStatus">
                                <option value="">Selecionar...</option>
                                <option value="PG">PG</option>
                                <option value="PENDENTE">PENDENTE</option>
                                <option value="RECALCULADO">RECALCULADO</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group full-width">
                            <label>Detalhe</label>
                            <input type="text" id="itemDetalhe" placeholder="Detalhes adicionais...">
                        </div>
                    </div>
                    
                    <button type="button" id="addItemBtn" class="add-item-btn">
                        <i class="fas fa-plus"></i> Adicionar Item
                    </button>
                </div>
                
                <!-- Lista de Itens Adicionados -->
                <div id="itemsList" class="items-list">
                    <!-- Itens serÃ£o listados aqui -->
                </div>
            </div>
            
            <!-- FormulÃ¡rio para Criar Evento -->
            <div class="create-event-form" style="display: none;" id="createEventForm">
                <h4><i class="fas fa-calendar-plus"></i> Criar Evento no Google Calendar</h4>
                
                <!-- âœ… NOVO: SeleÃ§Ã£o de Tipo e CalendÃ¡rio -->
                <div class="form-row">
                    <div class="form-group">
                        <label>Tipo de Evento *</label>
                        <select id="eventType" required>
                            <option value="PAGAMENTO">PAGAMENTO</option>
                            <option value="ENTRADA">ENTRADA</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>CalendÃ¡rio *</label>
                        <select id="eventCalendar" required>
                            <option value="primary">CalendÃ¡rio Principal</option>
                            <!-- Outros calendÃ¡rios serÃ£o carregados dinamicamente -->
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Data *</label>
                        <input type="date" id="eventDate" required>
                    </div>
                    <div class="form-group">
                        <label>HorÃ¡rio</label>
                        <input type="time" id="eventTime" value="09:00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>RecorrÃªncia *</label>
                    <select id="eventRecurrence" required onchange="handleRecurrenceChange()">
                        <option value="NONE">NÃ£o se repete</option>
                        <option value="DAILY">Todos os dias</option>
                        <option value="WEEKLY">Semanal: cada quinta-feira</option>
                        <option value="MONTHLY">Mensal no(a) terceiro(a) quinta-feira</option>
                        <option value="YEARLY">Anual em setembro 18</option>
                        <option value="WEEKDAYS">Todos os dias da semana (segunda a sexta-feira)</option>
                        <option value="CUSTOM">Personalizar...</option>
                    </select>
                </div>
                
                <div class="form-actions">
                    <button type="button" id="createEventBtn" class="create-event-btn">
                        <i class="fas fa-calendar-check"></i> Criar Evento
                    </button>
                    <button type="button" id="cancelEventBtn" class="cancel-event-btn">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </div>
        </div>

        <!-- BotÃ£o para mostrar criaÃ§Ã£o de eventos -->
        <div style="text-align: center; margin-bottom: 25px;">
            <button onclick="showEventCreator()" class="btn btn-primary" style="font-size: 16px; padding: 12px 25px;">
                <i class="fas fa-plus-circle"></i>
                Criar Novo Evento
            </button>
        </div>

        <!-- Filter Information -->
        <div id="filterSection" class="filter-section" style="display: none;">
            <div class="filter-info">
                <i class="fas fa-filter"></i>
                <span>Filtro Ativo: APENAS eventos com PAGAMENTO, PAGAMENTOS, HVC ou ENTRADA no TÃTULO</span>
            </div>
            <div class="filter-stats" id="filterStats">
                <!-- Stats will be populated here -->
            </div>
        </div>

        <!-- Calendar View -->
        <div id="calendarSection" class="calendar-section" style="display: none;">
            <div class="calendar-header">
                <div class="calendar-nav">
                    <button onclick="previousMonth()">
                        <i class="fas fa-chevron-left"></i> Anterior
                    </button>
                    <button onclick="goToToday()">
                        <i class="fas fa-calendar-day"></i> Hoje
                    </button>
                    <button onclick="nextMonth()">
                        PrÃ³ximo <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <h2 id="calendarTitle" class="calendar-title">Carregando...</h2>
            </div>
            <div id="calendarGrid" class="calendar-grid">
                <!-- Calendar will be rendered here -->
            </div>
        </div>

        <!-- BalanÃ§o Mensal ENTRADAS vs PAGAMENTOS -->
        <div id="monthlySummarySection" class="monthly-summary" style="display: none;">
            <h3><i class="fas fa-balance-scale"></i> BalanÃ§o do MÃªs</h3>
            
            <!-- âœ… NOVO: Saldo Confirmado (RC vs PG) -->
            <div class="balance-display" style="margin-bottom: 20px; border: 2px solid #28a745; border-radius: 10px; padding: 15px; background: rgba(40, 167, 69, 0.1);">
                <div class="balance-item entrada">
                    <div id="entradaRCBalance" class="balance-value" style="color: #28a745;">R$ 0,00</div>
                    <div class="balance-label">ENTRADAS (RC)</div>
                </div>
                
                <div class="vs-separator">VS</div>
                
                <div class="balance-item pagamento">
                    <div id="pagamentoPGBalance" class="balance-value" style="color: #ea4335;">R$ 0,00</div>
                    <div class="balance-label">PAGAMENTOS (PG)</div>
                </div>
            </div>
            
            <div class="balance-item saldo" style="margin-bottom: 20px;">
                <div id="saldoConfirmadoBalance" class="balance-value">R$ 0,00</div>
                <div class="balance-label">SALDO CONFIRMADO</div>
            </div>
            
            <!-- âœ… NOVO: Saldo Pendente (AGUARDANDO vs PENDENTE) -->
            <div class="balance-display" style="margin-bottom: 20px; border: 2px solid #ffc107; border-radius: 10px; padding: 15px; background: rgba(255, 193, 7, 0.1);">
                <div class="balance-item entrada">
                    <div id="entradaAguardandoBalance" class="balance-value" style="color: #28a745;">R$ 0,00</div>
                    <div class="balance-label">ENTRADAS (AGUARDANDO)</div>
                </div>
                
                <div class="vs-separator">VS</div>
                
                <div class="balance-item pagamento">
                    <div id="pagamentoPendenteBalance" class="balance-value" style="color: #ea4335;">R$ 0,00</div>
                    <div class="balance-label">PAGAMENTOS (PENDENTE)</div>
                </div>
            </div>
            
            <div class="balance-item saldo" style="margin-bottom: 20px;">
                <div id="saldoPendenteBalance" class="balance-value">R$ 0,00</div>
                <div class="balance-label">SALDO PENDENTE</div>
            </div>
            
            <!-- âœ… MODIFICADO: Saldo Total Geral -->
            <div class="balance-display" style="border: 3px solid #4285f4; border-radius: 10px; padding: 15px; background: rgba(66, 133, 244, 0.1);">
                <div class="balance-item entrada">
                    <div id="entradaTotalBalance" class="balance-value">R$ 0,00</div>
                    <div class="balance-label">TOTAL ENTRADAS</div>
                </div>
                
                <div class="vs-separator">VS</div>
                
                <div class="balance-item pagamento">
                    <div id="pagamentoTotalBalance" class="balance-value">R$ 0,00</div>
                    <div class="balance-label">TOTAL PAGAMENTOS</div>
                </div>
            </div>
            
            <div class="balance-item saldo">
                <div id="saldoBalance" class="balance-value" style="font-size: 2.2rem; font-weight: bold;">R$ 0,00</div>
                <div class="balance-label" style="font-size: 1.1rem; font-weight: bold;">SALDO TOTAL GERAL</div>
            </div>
            
            <div class="monthly-stats">
                <div class="stat-item">
                    <div id="totalEvents" class="stat-value">0</div>
                    <div class="stat-label">Total de Eventos</div>
                </div>
            </div>
        </div>

        <!-- Resumos Separados com Filtros -->
        <div id="separatedSummarySection" class="hvc-container" style="display: none;">
            <h2 style="color: #ffffff; text-align: center; margin-bottom: 30px;">
                <i class="fas fa-chart-pie"></i> Resumos Detalhados
            </h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                <!-- Resumo PAGAMENTOS com detalhes -->
                <div class="monthly-summary" style="background: rgba(234, 67, 53, 0.2); border-color: #ea4335;">
                    <h3 style="color: #ea4335;"><i class="fas fa-credit-card"></i> PAGAMENTOS</h3>
                    <div id="pagamentoTotal" class="balance-value" style="font-size: 1.8rem;">R$ 0,00</div>
                    
                    <div class="monthly-stats" style="margin-top: 15px;">
                        <div class="stat-item">
                            <div id="pagamentoPago" class="stat-value" style="color: #28a745;">R$ 0,00</div>
                            <div class="stat-label">Pago (PG)</div>
                        </div>
                        <div class="stat-item">
                            <div id="pagamentoPendente" class="stat-value" style="color: #ea4335;">R$ 0,00</div>
                            <div class="stat-label">Pendente</div>
                        </div>
                        <div class="stat-item">
                            <div id="pagamentoEvents" class="stat-value">0</div>
                            <div class="stat-label">Eventos</div>
                        </div>
                        <div class="stat-item">
                            <div id="pagamentoItems" class="stat-value">0</div>
                            <div class="stat-label">Itens</div>
                        </div>
                        <div class="stat-item">
                            <div id="pagamentoMedia" class="stat-value">R$ 0,00</div>
                            <div class="stat-label">MÃ©dia/Dia</div>
                        </div>
                    </div>
                </div>
                
                <!-- Resumo ENTRADAS -->
                <div class="monthly-summary" style="background: rgba(40, 167, 69, 0.2); border-color: #28a745;">
                    <h3 style="color: #28a745;"><i class="fas fa-arrow-down"></i> ENTRADAS</h3>
                    <div id="entradaTotal" class="balance-value" style="font-size: 1.8rem;">R$ 0,00</div>
                    <div class="monthly-stats" style="margin-top: 15px;">
                        <div class="stat-item">
                            <div id="entradaEvents" class="stat-value">0</div>
                            <div class="stat-label">Eventos</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Listas Separadas com Filtros -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <!-- Lista PAGAMENTOS com Filtros -->
                <div class="payments-list-section" style="background: rgba(234, 67, 53, 0.1);">
                    <h3 style="color: #ea4335; margin-bottom: 20px;">
                        <i class="fas fa-list"></i> Lista de Pagamentos
                    </h3>
                    
                    <!-- Filtros para Pagamentos -->
                    <div class="payments-filters">
                        <div class="filter-group">
                            <label class="filter-label">Nome/Evento</label>
                            <input type="text" id="nameFilterPagamentos" class="filter-input" placeholder="Filtrar...">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Data</label>
                            <input type="date" id="dateFilterPagamentos" class="filter-input">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Status</label>
                            <select id="statusFilterPagamentos" class="filter-select">
                                <option value="">Todos</option>
                                <option value="PG">PG</option>
                                <option value="PENDENTE">Pendente</option>
                                <option value="RECALCULADO">Recalculado</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Conta</label>
                            <select id="accountFilterPagamentos" class="filter-select">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <button id="clearFiltersPagamentos" class="clear-filters-btn">
                                <i class="fas fa-times"></i> Limpar
                            </button>
                        </div>
                    </div>
                    
                    <div id="pagamentosList" class="payments-list">
                        <!-- Lista serÃ¡ preenchida via JavaScript -->
                    </div>
                </div>
                
                <!-- Lista ENTRADAS com Filtros -->
                <div class="payments-list-section" style="background: rgba(40, 167, 69, 0.1);">
                    <h3 style="color: #28a745; margin-bottom: 20px;">
                        <i class="fas fa-list"></i> Lista de Entradas
                    </h3>
                    
                    <!-- Filtros para Entradas -->
                    <div class="payments-filters">
                        <div class="filter-group">
                            <label class="filter-label">Nome/Evento</label>
                            <input type="text" id="nameFilterEntradas" class="filter-input" placeholder="Filtrar...">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Data</label>
                            <input type="date" id="dateFilterEntradas" class="filter-input">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Status</label>
                            <select id="statusFilterEntradas" class="filter-select">
                                <option value="">Todos</option>
                                <option value="RC">RC</option>
                                <option value="AGUARDANDO">Aguardando</option>
                                <option value="ADIADO">Adiado</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Conta</label>
                            <select id="accountFilterEntradas" class="filter-select">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <button id="clearFiltersEntradas" class="clear-filters-btn">
                                <i class="fas fa-times"></i> Limpar
                            </button>
                        </div>
                    </div>
                    
                    <div id="entradaList" class="payments-list">
                        <!-- Lista serÃ¡ preenchida via JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Event Details Modal -->
        <div id="eventModal" class="event-modal">
            <div class="event-modal-content">
                <span class="close" onclick="closeModal('eventModal')">&times;</span>
                <h2 id="eventModalTitle">Detalhes do Evento</h2>
                <div id="eventModalBody">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="supabase.js"></script>
    <script type="module" src="dashboard-hvc.js"></script>
    <script type="module">
        import { injectSidebar } from './sidebar.js';
        injectSidebar("main-content-fluxo-caixa-hvc");
    </script>
    
    <!-- Load Google APIs -->
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gsiLoaded()"></script>
</body>
</html>

